<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <title>اللعبة المباشرة</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <style>
    body {
      font-family: 'Tajawal', system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background: #000;
      color: #fff;
      margin: 0;
      padding: 0;
    }
    .wrap {
      max-width: 800px;
      margin: 60px auto;
      text-align: center;
      padding: 20px;
    }
    h1 {
      font-size: 26px;
      margin-bottom: 20px;
      font-weight: 700;
    }
    .scene {
      background: #0e0e0e;
      border: 1px solid #222;
      border-radius: 16px;
      padding: 24px;
    }
    #sceneTitle {
      font-size: 22px;
      margin-bottom: 20px;
      color: #ffdc73;
    }
    .choices {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    .btn {
      background: #141414;
      border: 1px solid #333;
      border-radius: 14px;
      padding: 18px;
      font-size: 20px;
      color: #fff;
      transition: 0.2s;
      cursor: pointer;
    }
    .btn:hover {
      background: #1f1f1f;
      transform: scale(1.02);
    }
    .debug {
      position: fixed;
      bottom: 10px;
      left: 10px;
      background: #111;
      border: 1px solid #333;
      border-radius: 10px;
      padding: 10px;
      font-size: 12px;
      color: #999;
      max-width: 300px;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <h1>اللعبة المباشرة</h1>
    <div class="scene">
      <div id="sceneTitle">تحميل...</div>
      <div class="choices">
        <button id="choiceLeft" class="btn">...</button>
        <button id="choiceRight" class="btn">...</button>
      </div>
    </div>
  </div>

  <div class="debug">
    <div><b>Backend:</b> beamingkhaled.github.io</div>
    <div id="debugStatus">Status: ⏳ Loading...</div>
  </div>

  <script>
    // ✅ Fixed backend URL - Using RAW GitHub file
    const BACKEND_URL = 'https://raw.githubusercontent.com/beamingkhaled/beamingkhaled.github.io/main/admin.html';

    async function fetchLiveChoices() {
      try {
        const res = await fetch(BACKEND_URL, {
          cache: 'no-store',
          headers: { 'Pragma': 'no-cache', 'Cache-Control': 'no-cache' }
        });
        
        if (!res.ok) {
          throw new Error(`Network error: ${res.status}`);
        }
        
        const html = await res.text();

        // Extract <pre id="LIVE_CHOICES_JSON">
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        const pre = doc.querySelector('#LIVE_CHOICES_JSON');

        if (!pre) {
          document.getElementById('debugStatus').textContent = '❌ لم يتم العثور على JSON في الصفحة الخلفية.';
          return;
        }

        const data = JSON.parse(pre.textContent);
        applyChoices(data);
        document.getElementById('debugStatus').textContent = '✅ تم التحديث بنجاح (' + new Date().toLocaleTimeString() + ')';
      } catch (err) {
        document.getElementById('debugStatus').textContent = '⚠️ خطأ: ' + err.message;
      }
    }

    function applyChoices(data) {
      document.getElementById('sceneTitle').textContent = data.title || '';
      document.getElementById('choiceLeft').textContent = data.left || '';
      document.getElementById('choiceRight').textContent = data.right || '';
    }

    // Add button click events
    document.getElementById('choiceLeft').addEventListener('click', function() {
      alert('اخترت: ' + this.textContent);
    });
    
    document.getElementById('choiceRight').addEventListener('click', function() {
      alert('اخترت: ' + this.textContent);
    });

    // Run immediately and every 3s
    fetchLiveChoices();
    setInterval(fetchLiveChoices, 3000);
  </script>
</body>
</html>
