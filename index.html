<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>Tfadhloon | Live</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b0b0f;       /* inky dark */
      --ink:#111118;
      --card:#171724;
      --stroke:#2a2a3a;
      --text:#ffffff;
      --muted:#a6a6b3;
      --accent:#8a7dff;   /* soft neon violet */
      --accent-2:#00d6c9; /* minty teal */
      --good:#20e070;
      --bad:#ff4d4d;
      --radius:16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:'Tajawal', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(120vh 120vh at 80% -20%, #1a1440 0%, transparent 60%),
                  radial-gradient(120vh 120vh at -10% 110%, #0b3a35 0%, transparent 60%),
                  var(--bg);
      color:var(--text);
      overflow:hidden;
    }
    /* 9:16 safe area (TikTok Live) */
    .stage{
      position:fixed; inset:0;
      display:flex; align-items:center; justify-content:center;
      padding:12px;
    }
    .phone{
      width:min(92vw, 470px);
      aspect-ratio:9/16;
      background:linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
      border:1px solid rgba(255,255,255,0.08);
      border-radius:28px;
      backdrop-filter: blur(6px);
      box-shadow: 0 20px 60px rgba(0,0,0,.55);
      display:flex; flex-direction:column;
      overflow:hidden;
    }

    /* Top bar */
    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      padding:12px 14px;
      border-bottom:1px solid rgba(255,255,255,0.08);
      background:linear-gradient(180deg, rgba(0,0,0,.35), rgba(0,0,0,0));
    }
    .brand{
      display:flex; align-items:center; gap:10px; font-weight:800; letter-spacing:.2px;
    }
    .dot{width:10px; height:10px; border-radius:50%; background:var(--good); box-shadow:0 0 16px var(--good)}
    .live{font-size:12px; opacity:.85}
    .stamp{font-size:12px; color:var(--muted)}

    /* Content */
    .wrap{padding:18px 14px 16px; display:flex; flex-direction:column; gap:14px; flex:1}
    .title{
      padding:16px 14px;
      border-radius:var(--radius);
      background:var(--ink);
      border:1px solid var(--stroke);
      font-size:22px; line-height:1.35; font-weight:800; text-align:center;
      text-shadow: 0 1px 0 rgba(0,0,0,.25);
      box-shadow: inset 0 -18px 24px rgba(255,255,255,.02), 0 10px 28px rgba(0,0,0,.35);
    }
    .choice{
      padding:18px 16px;
      border-radius:20px;
      background:var(--card);
      border:1px solid var(--stroke);
      font-size:20px; line-height:1.4; font-weight:700; text-align:center;
      cursor:default; user-select:none;
      transform:translateZ(0);
      transition:transform .12s ease, box-shadow .12s ease, border-color .2s ease;
      box-shadow: 0 14px 28px rgba(0,0,0,.28);
    }
    .choice:hover{ transform:translateY(-1px) }
    .choice:active{ transform:translateY(0) scale(0.997) }

    .a{ outline:0; box-shadow: 0 8px 24px rgba(138,125,255,.25) }
    .b{ outline:0; box-shadow: 0 8px 24px rgba(0,214,201,.22) }
    .a .tag{ background:rgba(138,125,255,.18); border:1px solid rgba(138,125,255,.45) }
    .b .tag{ background:rgba(0,214,201,.18); border:1px solid rgba(0,214,201,.45) }

    .tag{
      display:inline-flex; align-items:center; gap:8px;
      padding:6px 10px; margin-bottom:8px;
      border-radius:999px; font-size:12px; font-weight:800; letter-spacing:.3px;
    }
    .pulse{animation:pulse 1s ease 1}
    @keyframes pulse{
      0%{ box-shadow:0 0 0 0 rgba(32,224,112,.45) }
      100%{ box-shadow:0 0 0 12px rgba(32,224,112,0) }
    }

    .foot{
      display:flex; align-items:center; justify-content:space-between;
      gap:10px; padding:12px 14px;
      border-top:1px solid rgba(255,255,255,.08);
      background:linear-gradient(0deg, rgba(0,0,0,.35), rgba(0,0,0,0));
      font-size:12px; color:var(--muted)
    }
    .status-ok{color:#9effc1}
    .status-bad{color:#ffb0b0}

    /* Loading shimmer */
    .shimmer{
      position:relative; overflow:hidden; background: #12121b;
    }
    .shimmer::after{
      content:""; position:absolute; inset:0;
      background: linear-gradient(120deg, transparent 0%, rgba(255,255,255,.06) 30%, transparent 60%);
      transform:translateX(-100%); animation:sh 1.2s linear infinite;
    }
    @keyframes sh { to { transform:translateX(100%) } }

    /* Scroll safety for chat overlays */
    .scrollpad{height:8px}
  </style>
</head>
<body>
  <div class="stage">
    <main class="phone" role="main" aria-live="polite">
      <header class="topbar">
        <div class="brand">
          <span class="dot" id="liveDot" title="LIVE"></span>
          <span>Tfadhloon</span>
          <span class="live">LIVE</span>
        </div>
        <div class="stamp" id="stamp">—</div>
      </header>

      <section class="wrap">
        <div id="title" class="title shimmer">جارِ التحميل…</div>

        <div class="choice a" id="left">
          <div class="tag">١</div>
          <div class="text">—</div>
        </div>

        <div class="choice b" id="right">
          <div class="tag">٢</div>
          <div class="text">—</div>
        </div>

        <div class="scrollpad"></div>
      </section>

      <footer class="foot">
        <div id="status">Connecting…</div>
        <div id="source" class="stamp">source: raw.githubusercontent.com</div>
      </footer>
    </main>
  </div>

  <script>
    /*
      FINAL LIVE FRONT-END
      - Polls your JSON every 1500ms
      - Forces a fresh copy each time (?nocache=timestamp + cache:'no-store')
      - Updates UI only when content actually changes (no flicker)
      - Accepts multiple key names so your backend can be flexible

      Expected JSON (any of these key sets work):
      {"title": "...", "left": "...", "right": "..."}
      or {"q": "...", "a": "...", "b": "..."}
      or {"question":"...", "option1":"...", "option2":"..."}
    */

    const JSON_URL = "https://raw.githubusercontent.com/beamingkhaled/BQ8/main/choices.json";

    const $title = document.getElementById("title");
    const $left  = document.getElementById("left").querySelector(".text");
    const $right = document.getElementById("right").querySelector(".text");
    const $stamp = document.getElementById("stamp");
    const $status = document.getElementById("status");
    const $dot = document.getElementById("liveDot");
    const $source = document.getElementById("source");

    let lastPayloadHash = "";
    let failCount = 0;

    function nowClock(){
      const d = new Date();
      return d.toLocaleTimeString([], {hour12:false});
    }

    function normalize(data){
      // Map multiple possible schemas to one
      const title = data.title ?? data.q ?? data.question ?? "—";
      const left  = data.left  ?? data.a ?? data.option1 ?? "—";
      const right = data.right ?? data.b ?? data.option2 ?? "—";
      return {title, left, right};
    }

    async function getChoices(){
      const url = JSON_URL + (JSON_URL.includes("?") ? "&" : "?") + "nocache=" + Date.now();
      const res = await fetch(url, { cache: "no-store" });
      if(!res.ok) throw new Error("HTTP " + res.status);
      return res.json();
    }

    function applyUI({title,left,right}){
      // Remove loading shimmer on first success
      $title.classList.remove("shimmer");

      const newHash = JSON.stringify({title,left,right});
      if(newHash === lastPayloadHash) return;  // nothing changed; keep calm

      lastPayloadHash = newHash;

      $title.textContent = title || "—";
      $left.textContent  = left  || "—";
      $right.textContent = right || "—";

      // Little pulse to signal an update landed
      $dot.classList.remove("pulse");
      void $dot.offsetWidth; // reflow to restart animation
      $dot.classList.add("pulse");

      $stamp.textContent = "تم التحديث " + nowClock();
    }

    async function tick(){
      try{
        const data = await getChoices();
        const norm = normalize(data);
        applyUI(norm);

        failCount = 0;
        $status.textContent = "LIVE · OK";
        $status.className = "status-ok";
      }catch(err){
        failCount++;
        $status.textContent = "إعادة المحاولة… (" + failCount + ")";
        $status.className = "status-bad";
        if(failCount > 2){
          // keep the LIVE dot visible but reduce glow on repeated failures
          $dot.style.boxShadow = "0 0 8px rgba(255,77,77,.65)";
          $dot.style.background = "var(--bad)";
        }
      }
    }

    // Kickoff
    (function init(){
      $source.textContent = "source: raw.githubusercontent.com";
      tick();
      setInterval(tick, 1500); // ~1.5s cadence feels instant on stream
    })();
  </script>
</body>
</html>
