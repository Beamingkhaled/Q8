<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Avenues & Dragons</title>

  <!-- Kill caching on Safari/iPad -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">

  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;800&display=swap" rel="stylesheet">

  <style>
    /* ======== THEME ======== */
    :root{
      --ink:#ffffff;
      --muted:#b9bfd2;

      --glass: 1;
      --glass-bg: rgba(22, 18, 40, 0.36);
      --glass-border: rgba(255,255,255,0.18);
      --glass-backdrop: blur(14px);

      --radius: 20px;
      --pad: 28px;
      --shadow: 0 24px 70px rgba(0,0,0,.45);

      --overlay: rgba(10, 8, 20, 0.55);
      --vignette: radial-gradient(1200px 700px at 50% -10%, rgba(0,0,0,0.18) 0%, rgba(0,0,0,0.55) 60%, rgba(0,0,0,0.75) 100%);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--ink);
      font-family:'Tajawal', system-ui, -apple-system, sans-serif;
      display:flex;align-items:center;justify-content:center;
      overflow:hidden;
      background:#0b0a15;
    }

    /* ======== Background Image ======== */
    .bg-wrap{
      position:fixed; inset:0; z-index:-3; 
      background-image:url('bg.jpg');
      background-size:cover;
      background-position:center;
      background-repeat:no-repeat;
      filter:brightness(0.9) saturate(1.05);
    }
    .bg-overlay{
      position:fixed; inset:0; z-index:-2;
      background: var(--overlay);
      pointer-events:none;
    }
    .bg-vignette{
      position:fixed; inset:0; z-index:-1;
      background: var(--vignette);
      pointer-events:none;
    }

    /* ======== Card ======== */
    .card{
      width:min(92vw,800px);
      padding:var(--pad);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      backdrop-filter: var(--glass-backdrop);
    }

    .title{font-size:28px;font-weight:800;text-align:center}
    .q{margin:18px 0 22px;text-align:center;color:var(--muted);min-height:28px;font-size:18px}

    .row{display:flex;gap:16px;flex-wrap:wrap;justify-content:center}
    .opt{
      flex:1 1 320px;
      border-radius:14px;
      padding:18px 20px;
      text-align:center;
      font-size:18px;font-weight:800;
      background: rgba(34, 28, 60, 0.65);
      border:1px solid rgba(255,255,255,.10);
      backdrop-filter: blur(8px);
      box-shadow: 0 10px 28px rgba(0,0,0,.28);
    }

    .s{margin-top:14px;text-align:center;color:var(--muted);font-size:13px}
  </style>
</head>
<body>

  <!-- Background -->
  <div class="bg-wrap"></div>
  <div class="bg-overlay"></div>
  <div class="bg-vignette"></div>

  <!-- UI -->
  <div id="card" class="card">
    <div class="title">Avenues & Dragons</div>
    <div id="q" class="q">–</div>

    <div class="row">
      <div id="a" class="opt">–</div>
      <div id="b" class="opt">–</div>
    </div>

    <div id="s" class="s">بانتظار الاتصال…</div>
  </div>

  <script>
    /* Detect ?bin= and fallback */
    const params = new URLSearchParams(location.search);
    const bin = params.get('bin') || '690fb624d0ea881f40dc579f';
    const BASE = `https://api.jsonbin.io/v3/b/${bin}/latest`;

    const els = {
      q: document.getElementById('q'),
      a: document.getElementById('a'),
      b: document.getElementById('b'),
      s: document.getElementById('s')
    };
    let last = '';

    function normalize(rec){
      const r = rec && rec.record ? rec.record : rec || {};
      return {
        question: r.question ?? r.title ?? '–',
        a: r.a ?? r.left ?? '–',
        b: r.b ?? r.right ?? '–'
      };
    }

    async function pull(){
      try{
        const t = Date.now();
        let res = await fetch(`${BASE}?meta=false&ts=${t}`, { cache: 'no-store' });
        let data = await res.json();
        if (!res.ok) throw new Error('bad');

        const next = normalize(data);
        const key = JSON.stringify(next);
        if (key !== last){
          els.q.textContent = next.question;
          els.a.textContent = next.a;
          els.b.textContent = next.b;
          last = key;
        }
        els.s.textContent = 'متصل • يتم التحديث تلقائيًا';

      } catch(e){
        try{
          const t2 = Date.now();
          const res2 = await fetch(`${BASE}?ts=${t2}`, { cache: 'no-store' });
          const data2 = await res2.json();
          const next2 = normalize(data2);
          const key2 = JSON.stringify(next2);
          if (key2 !== last){
            els.q.textContent = next2.question;
            els.a.textContent = next2.a;
            els.b.textContent = next2.b;
            last = key2;
          }
          els.s.textContent = 'متصل • يتم التحديث تلقائيًا';
        } catch(e2){
          els.s.textContent = 'لا يوجد اتصال (سيُعاد المحاولة)…';
        }
      }
    }

    pull();
    setInterval(pull, 1500);
  </script>

</body>
</html>
