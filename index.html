<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø£ÙÙŠÙ†ÙˆØ² ÙˆØ§Ù„ØªÙ†Ø§Ù†ÙŠÙ† - Avenues & Dragons</title>
  <style>
    /* RESET */
    *{margin:0;padding:0;box-sizing:border-box}
    html,body{height:100%}

    /* Background & layout */
    body{
      font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background:#000;           /* photo applied via #bgImage */
      min-height:100vh;
      display:flex;justify-content:center;align-items:center;
      padding:20px;position:relative;overflow:hidden;
    }
    /* Full-screen background image (dynamic) */
    #bgImage{
      position:fixed;inset:0;width:100%;height:100%;
      object-fit:cover;z-index:-3;
    }
    /* Subtle black gradient overlay to make neon pop */
    #bgOverlay{
      position:fixed;inset:0;z-index:-2;pointer-events:none;
      background:linear-gradient(
        to bottom,
        rgba(0,0,0,0.05) 0%,
        rgba(0,0,0,0.15) 40%,
        rgba(0,0,0,0.35) 70%,
        rgba(0,0,0,0.50) 100%
      );
    }

    .game-container{
      background:rgba(255,255,255,0.08);
      border-radius:20px;
      padding:40px;
      max-width:800px;width:100%;
      box-shadow:0 20px 60px rgba(0,0,0,0.40);
      animation:fadeIn .5s ease;
      backdrop-filter:blur(8px);
      border:1px solid rgba(255,255,255,0.16);
    }
    @keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
    @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}

    .game-title{
      font-size:2.5em;color:#fff;text-align:center;margin-bottom:30px;
      text-shadow:0 0 10px rgba(122,92,255,0.75),0 0 24px rgba(122,92,255,0.55);
      letter-spacing:.5px;
    }

    .question-box{
      background:rgba(0,0,0,0.45);color:#fff;padding:30px;border-radius:15px;margin-bottom:30px;
      font-size:1.5em;text-align:center;min-height:120px;display:flex;align-items:center;justify-content:center;
      border:2px solid #7a5cff;box-shadow:0 0 18px #7a5cff66,inset 0 0 12px #7a5cff22;
    }
    .question-box.updating{animation:pulse .5s ease}

    .choices-container{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px}

    .choice-btn{
      position:relative;
      background:rgba(10,10,30,0.70);
      color:#fff;border:2px solid #a78bfa;padding:25px;border-radius:14px;
      font-size:1.2em;cursor:pointer;transition:all .25s ease;
      box-shadow:0 0 18px rgba(167,139,250,0.55), inset 0 0 10px rgba(167,139,250,0.20);
      font-family:inherit;
    }
    .choice-btn:hover{
      transform:translateY(-4px);
      box-shadow:0 0 25px rgba(167,139,250,0.85), inset 0 0 12px rgba(167,139,250,0.30);
    }
    .choice-btn.updating{animation:pulse .5s ease}

    /* small corner stickers */
    .sticker{
      position:absolute;top:-12px;left:-12px;padding:6px 12px;
      background:rgba(255,255,255,0.20);color:#fff;border-radius:12px;
      font-weight:800;font-size:14px;border:1px solid rgba(255,255,255,0.45);
      backdrop-filter:blur(6px);box-shadow:0 0 12px rgba(255,255,255,0.22);
      pointer-events:none;text-shadow:0 0 10px rgba(255,255,255,0.45),0 0 20px rgba(167,139,250,0.55);
    }

    .status{
      text-align:center;color:#e5e5e5;font-size:.95em;margin-top:20px;padding:10px;
      background:rgba(122,92,255,0.12);border-radius:8px;border:1px solid rgba(122,92,255,0.25);
    }
    .status.connected{color:#10b981;background:rgba(16,185,129,0.12);border-color:rgba(16,185,129,0.35);font-weight:600}
    .status.updating{color:#f59e0b;background:rgba(245,158,11,0.12);border-color:rgba(245,158,11,0.35);font-weight:700}

    @media (max-width:600px){
      .game-container{padding:20px}
      .game-title{font-size:1.9em;margin-bottom:20px}
      .question-box{font-size:1.2em;padding:20px}
      .choices-container{grid-template-columns:1fr}
      .choice-btn{font-size:1.1em;padding:20px}
    }
  </style>
</head>
<body>
  <!-- background layers -->
  <img id="bgImage" src="" alt="">
  <div id="bgOverlay"></div>

  <div class="game-container">
    <h1 class="game-title">Ø£ÙÙŠÙ†ÙˆØ² ÙˆØ§Ù„ØªÙ†Ø§Ù†ÙŠÙ†</h1>

    <div class="question-box" id="question">Ø§Ù†ØªØ¸Ø± Ø§Ù„Ø³Ø¤Ø§Ù„ Ù…Ù† Ø§Ù„Ù…Ù‚Ø¯Ù…...</div>

    <div class="choices-container">
      <button class="choice-btn" id="choice1">
        <span class="sticker">Ø§ÙƒØªØ¨ÙˆØ§ Ù¡</span>
        <span class="txt">Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø£ÙˆÙ„</span>
      </button>
      <button class="choice-btn" id="choice2">
        <span class="sticker">Ø§ÙƒØªØ¨ÙˆØ§ Ù¢</span>
        <span class="txt">Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ</span>
      </button>
      <button class="choice-btn" id="choice3"><span class="txt">Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø«Ø§Ù„Ø«</span></button>
      <button class="choice-btn" id="choice4"><span class="txt">Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø±Ø§Ø¨Ø¹</span></button>
    </div>

    <div class="status connected" id="status">ğŸŸ¢ Ø¬Ø§Ù‡Ø² - ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª</div>
  </div>

  <script>
    /* ===== Your original logic (unchanged) ===== */
    let lastTimestamp = 0;
    let bc = null;

    // BroadcastChannel
    try {
      bc = new BroadcastChannel('q8_game_channel');
      bc.onmessage = function(event){
        console.log('Received via BroadcastChannel:', event.data);
        if(event.data && event.data.timestamp > lastTimestamp){
          lastTimestamp = event.data.timestamp;
          showUpdateAnimation();
          updateGameDisplay(event.data);
        }
      };
    } catch(e){ console.log('BroadcastChannel not supported'); }

    // storage events
    window.addEventListener('storage', function(e){
      if(e.key === 'q8_game_data' && e.newValue){
        try{
          const data = JSON.parse(e.newValue);
          console.log('Received via storage event:', data);
          if(data.timestamp > lastTimestamp){
            lastTimestamp = data.timestamp;
            showUpdateAnimation();
            updateGameDisplay(data);
            if(bc) bc.postMessage(data);
          }
        }catch(err){ console.error('Parse error:', err); }
      }
    });

    // polling
    setInterval(function(){
      try{
        const stored = localStorage.getItem('q8_game_data');
        if(stored){
          const data = JSON.parse(stored);
          if(data.timestamp > lastTimestamp){
            lastTimestamp = data.timestamp;
            console.log('Received via polling:', data);
            showUpdateAnimation();
            updateGameDisplay(data);
            if(bc) bc.postMessage(data);
          }
        }
      }catch(err){ console.error('Poll error:', err); }
    }, 1000);

    function showUpdateAnimation(){
      const statusEl = document.getElementById('status');
      const questionEl = document.getElementById('question');

      statusEl.textContent = 'âš¡ ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ù„Ù„ØªÙˆ!';
      statusEl.className = 'status updating';

      questionEl.classList.add('updating');
      document.querySelectorAll('.choice-btn').forEach(btn => btn.classList.add('updating'));

      setTimeout(()=>{
        questionEl.classList.remove('updating');
        document.querySelectorAll('.choice-btn').forEach(btn => btn.classList.remove('updating'));
        statusEl.textContent = 'ğŸŸ¢ Ø¬Ø§Ù‡Ø² - ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª';
        statusEl.className = 'status connected';
      }, 2000);
    }

    function updateGameDisplay(data){
      if(data.title){
        document.querySelector('.game-title').textContent = data.title;
      }
      if(data.question){
        document.getElementById('question').textContent = data.question;
      }
      if(data.choices){
        document.querySelector('#choice1 .txt').textContent = data.choices[0] || 'Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø£ÙˆÙ„';
        document.querySelector('#choice2 .txt').textContent = data.choices[1] || 'Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ';
        document.querySelector('#choice3 .txt').textContent = data.choices[2] || 'Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø«Ø§Ù„Ø«';
        document.querySelector('#choice4 .txt').textContent = data.choices[3] || 'Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø±Ø§Ø¨Ø¹';
      }
      /* NEW: apply full-screen background if provided */
      if (data.bg){
        document.getElementById('bgImage').src = data.bg;
      }
    }

    // initial load
    try{
      const initialData = localStorage.getItem('q8_game_data');
      if(initialData){
        const data = JSON.parse(initialData);
        lastTimestamp = data.timestamp || 0;
        updateGameDisplay(data);
        console.log('Loaded initial data:', data);
      }
    }catch(err){ console.error('Initial load error:', err); }

    // rebroadcast helper
    window.addEventListener('storage', function(e){
      if(e.key === 'q8_game_data' && e.newValue && bc){
        try{ bc.postMessage(JSON.parse(e.newValue)); }catch(err){}
      }
    });
  </script>
</body>
</html>
