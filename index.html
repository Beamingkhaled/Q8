<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Avenues & Dragons | TikTok Live</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;800&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --ink:#fff; --vio:#8b5cf6; --vio2:#6366f1; --gold:#f59e0b; --succ:#10b981; --danger:#ef4444; --bg:#000;
      --glass:rgba(255,255,255,.08);
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{background:#000;color:var(--ink);font-family:'Tajawal','Poppins',system-ui,sans-serif;display:flex;align-items:center;justify-content:center;overflow:hidden}

    /* 9:16 canvas */
    .game{position:relative;width:min(100vw,54rem);aspect-ratio:9/16;background:#000;border:2px solid var(--vio);border-radius:20px;overflow:hidden;isolation:isolate}

    /* Top bar + Hype */
    .top{position:absolute;inset:0 0 auto 0;display:flex;align-items:center;gap:8px;padding:8px 12px;z-index:100;background:linear-gradient(90deg,#1a1a2e,#16213e,#0f3460);border-bottom:2px solid var(--vio)}
    .chip{background:rgba(139,92,246,.3);padding:4px 8px;border-radius:12px;font-weight:800;font-size:.8rem;white-space:nowrap}
    .logo{margin-inline:auto;font-family:'Poppins',sans-serif;font-weight:800;color:var(--vio);text-shadow:0 0 12px rgba(139,92,246,.5)}
    .hypeWrap{position:absolute;inset:auto 12px auto 12px;top:40px;z-index:100}
    .hypeBar{height:10px;background:rgba(255,255,255,.12);border:1px solid var(--vio);border-radius:8px;overflow:hidden}
    .hypeBar>span{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--vio),var(--vio2));transition:width .25s ease}
    .hypeLabel{display:flex;justify-content:space-between;font-size:.72rem;margin-top:4px;opacity:.9}

    /* Background crossfade */
    .bg{position:absolute;inset:0;background-size:cover;background-position:center;transition:opacity .4s ease}
    .bg.next{opacity:0}
    .overlay{position:absolute;inset:0;background:linear-gradient(0deg,rgba(0,0,0,.7) 0%,rgba(0,0,0,.35) 50%,rgba(0,0,0,.7) 100%);z-index:1}
    /* subtle drift */
    @keyframes drift{0%{transform:scale(1.05) translate(0,0)}50%{transform:scale(1.05) translate(6px,-6px)}100%{transform:scale(1.05) translate(0,0)}}
    .bg{animation:drift 12s ease-in-out infinite}

    /* Scene title */
    .scene{position:absolute;top:64px;right:10px;background:rgba(0,0,0,.8);padding:8px 14px;border-radius:12px;border:1px solid var(--vio);font-weight:800;color:var(--vio);z-index:45;backdrop-filter:blur(10px);font-size:.82rem}

    /* Character */
    .actorWrap{position:absolute;bottom:24%;left:16px;z-index:50}
    .actor{width:120px;height:120px;line-height:120px;text-align:center;font-size:80px;filter:drop-shadow(0 0 12px rgba(255,255,255,.55));animation:float 3s ease-in-out infinite}
    @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}

    /* Leaderboard + vote meters */
    .board{position:absolute;top:64px;left:10px;background:rgba(0,0,0,.8);padding:10px;border-radius:12px;border:1px solid var(--vio);width:160px;backdrop-filter:blur(10px);z-index:45}
    .board h3{font-size:.82rem;margin-bottom:8px;text-align:center;color:var(--vio)}
    .row{display:flex;align-items:center;gap:6px;margin-bottom:6px;background:var(--glass);padding:4px;border-radius:6px;font-size:.72rem}
    .rank{font-weight:800;color:var(--gold)}
    .score{margin-inline-start:auto;color:var(--succ);font-weight:800}
    .meters{display:grid;gap:6px;margin-top:8px}
    .meter{height:10px;background:rgba(255,255,255,.08);border-radius:8px;overflow:hidden}
    .meter>span{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--vio),var(--vio2));transition:width .3s ease}

    /* Boss HP (shows on boss scenes) */
    .boss{position:absolute;top:98px;left:50%;transform:translateX(-50%);min-width:50%;background:rgba(0,0,0,.7);padding:6px 10px;border:1px solid var(--danger);border-radius:10px;z-index:46;display:none}
    .boss h4{font-size:.8rem;margin-bottom:4px;color:#ffb4b4;text-align:center}
    .bossBar{height:12px;background:rgba(255,255,255,.1);border-radius:8px;overflow:hidden}
    .bossBar>span{display:block;height:100%;width:100%;background:linear-gradient(90deg,#ef4444,#f97316);transition:width .25s ease}

    /* Game content */
    .hud{position:absolute;inset:auto 0 0 0;padding:16px;background:linear-gradient(transparent,rgba(0,0,0,.92));z-index:40}
    .narr{min-height:88px;background:rgba(0,0,0,.7);border:1px solid var(--vio);border-radius:14px;padding:14px;text-align:center;font-size:1rem;line-height:1.6;margin-bottom:10px;backdrop-filter:blur(10px)}
    .choices{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
    .btn{background:linear-gradient(45deg,var(--vio),var(--vio2));border:none;border-radius:12px;padding:12px 8px;color:#fff;font-weight:800;display:flex;flex-direction:column;align-items:center;gap:5px;min-height:64px;cursor:pointer;transition:transform .15s ease,box-shadow .15s ease}
    .btn:hover{transform:translateY(-2px);box-shadow:0 8px 18px rgba(139,92,246,.35)}
    .btn.selected{background:linear-gradient(45deg,#f59e0b,#f97316);box-shadow:0 0 20px rgba(245,158,11,.6)}
    .icon{font-size:1rem}

    /* Prompt ticker */
    .ticker{margin-top:10px;font-size:.9rem;opacity:.9;text-align:center}

    /* Popup */
    .popup{position:absolute;inset:0;background:rgba(0,0,0,.9);display:none;align-items:center;justify-content:center;z-index:1000}
    .card{background:linear-gradient(135deg,#1e1b4b,#3730a3);padding:24px;border-radius:18px;border:2px solid var(--vio);max-width:320px;text-align:center;backdrop-filter:blur(10px);animation:pop .5s ease}
    @keyframes pop{0%{transform:scale(.5);opacity:0}100%{transform:scale(1);opacity:1}}
    .card h3{margin-bottom:10px}
    .ok{background:linear-gradient(45deg,#10b981,#059669);border:none;border-radius:10px;padding:10px 16px;color:#fff;font-weight:800;cursor:pointer}

    /* Particles & Confetti */
    #fx{position:absolute;inset:0;pointer-events:none;z-index:30}
    .spark{position:absolute;width:8px;height:8px;background:var(--vio);border-radius:50%;animation:spark 1s ease-out forwards}
    @keyframes spark{0%{transform:translate(0,0) scale(1);opacity:1}100%{transform:translate(var(--tx),var(--ty)) scale(0);opacity:0}}
    .conf{position:absolute;width:8px;height:12px;background:currentColor;transform:rotate(var(--rot));animation:fall 900ms ease-out forwards}
    @keyframes fall{to{transform:translate(var(--tx),var(--ty)) rotate(calc(var(--rot) + 180deg));opacity:0}}

    /* Admin panel */
    .admin{position:absolute;top:10px;left:10px;background:rgba(0,0,0,.9);padding:12px;border-radius:10px;border:2px solid var(--gold);z-index:2000;max-width:230px;backdrop-filter:blur(10px);display:none}
    .admin h3{color:var(--gold);text-align:center;margin-bottom:8px}
    .grid{display:grid;gap:6px}
    .admin button{background:#374151;border:none;border-radius:6px;padding:8px;color:#fff;font-size:.8rem;cursor:pointer}
    .admin button:hover{background:#4b5563}

    /* Fever + Sudden Death FX */
    body[data-fever="1"] .game{filter:saturate(1.4) brightness(1.1);box-shadow:0 0 40px rgba(139,92,246,.6) inset}
    .sudden{position:absolute;inset:0;z-index:999;pointer-events:none;display:none}
    .sudden.show{display:block;background:rgba(239,68,68,.1)}
    .suddenText{position:absolute;top:45%;left:50%;transform:translate(-50%,-50%);font-size:1.2rem;background:#7f1d1d;padding:10px 14px;border:2px solid #ef4444;border-radius:12px}

    /* Shake utility */
    @keyframes shakeK{10%,90%{transform:translateX(-2px)}20%,80%{transform:translateX(4px)}30%,50%,70%{transform:translateX(-8px)}40%,60%{transform:translateX(8px)}}
    .shake{animation:shakeK .5s}

    @media (max-width:420px){
      .board{width:150px}
      .actor{width:110px;height:110px;line-height:110px;font-size:72px}
      .narr{font-size:.95rem;min-height:78px}
    }
  </style>
</head>
<body>
  <div class="game" id="root" aria-live="polite">
    <!-- Top -->
    <div class="top">
      <div class="chip" id="timer">â±ï¸ 00:30</div>
      <div class="logo">Avenues & Dragons</div>
      <div class="chip" id="viewers">ğŸ‘ï¸ 1.2K</div>
      <div class="chip" id="runChip">ğŸ… Runs: <b id="runs">0</b></div>
      <div class="chip" id="sponsor">ğŸª© Prestige</div>
    </div>
    <div class="hypeWrap">
      <div class="hypeBar"><span id="hypeFill"></span></div>
      <div class="hypeLabel"><span>ğŸ”¥ Hype</span><span id="hypePct">0%</span></div>
    </div>

    <!-- Backgrounds -->
    <div class="bg" id="bgA"></div>
    <div class="bg next" id="bgB"></div>
    <div class="overlay"></div>

    <!-- Scene title -->
    <div class="scene" id="sceneTitle">Ø§Ù„Ù…Ø´Ù‡Ø¯ Ù¡: Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø£ÙÙ†ÙŠÙˆØ²</div>

    <!-- Boss HP -->
    <div class="boss" id="bossBox">
      <h4>ğŸ§¿ Ø§Ù„Ù…Ø¯ÙŠØ± â€” ØµØ­Ø© Ø§Ù„Ø²Ø¹ÙŠÙ…</h4>
      <div class="bossBar"><span id="bossHPBar"></span></div>
    </div>

    <!-- Character -->
    <div class="actorWrap"><div class="actor" id="actor" aria-label="Ø§Ù„Ø´Ø®ØµÙŠØ©">ğŸ‘¸</div></div>

    <!-- Board -->
    <div class="board">
      <h3>ğŸ† Ø£Ø¨Ø·Ø§Ù„ Ø§Ù„Ù‚Ø§Ø¹Ø©</h3>
      <div class="row"><span class="rank">1</span><span>ğŸ‘‘</span><span>Ù†ÙˆØ±_Ø§Ù„ÙƒÙˆÙŠØª</span><span class="score">1.5K</span></div>
      <div class="row"><span class="rank">2</span><span>âš”ï¸</span><span>Ø£Ø­Ù…Ø¯_Ø§Ù„Ù…ÙˆÙ„</span><span class="score">1.2K</span></div>
      <div class="row"><span class="rank">3</span><span>ğŸ›¡ï¸</span><span>ÙØ§Ø·Ù…Ø©_Ø§Ù„Ø³Ø­Ø±</span><span class="score">800</span></div>
      <div class="meters">
        <div class="meter"><span id="bar1"></span></div>
        <div class="meter"><span id="bar2"></span></div>
        <div class="meter"><span id="bar3"></span></div>
      </div>
    </div>

    <!-- HUD -->
    <div class="hud">
      <div class="narr" id="narr">Ù…Ø±Ø­Ø¨Ø§Ù‹ ÙÙŠ Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø£ÙÙ†ÙŠÙˆØ² Ø§Ù„Ø³Ø­Ø±ÙŠ! Ø§Ø®ØªØ§Ø±ÙˆØ§ Ø³Ù„Ø§Ø­ÙƒÙ… Ù„Ù„Ø¨Ø¯Ø§ÙŠØ©...</div>
      <div class="choices" id="choices"></div>
      <div class="ticker" id="ticker">Ø§ÙƒØªØ¨ÙˆØ§ <b>Ø³ÙŠÙ</b> / <b>Ø¯Ø±Ø¹</b> / <b>Ù‚Ù‡ÙˆØ©</b> Ù„Ø§Ø®ØªÙŠØ§Ø±ÙƒÙ…!</div>
    </div>

    <!-- FX & Overlays -->
    <div id="fx"></div>
    <div class="sudden" id="sudden"><div class="suddenText">âš ï¸ ØªØ¹Ø§Ø¯Ù„! Ø§ÙƒØªØ¨ÙˆØ§ <b>Ø¨Ø±Ù‚</b> Ø§Ù„Ø¢Ù† Ù„ÙƒØ³Ø± Ø§Ù„ØªØ¹Ø§Ø¯Ù„</div></div>

    <!-- Popup -->
    <div class="popup" id="popup" role="dialog" aria-modal="true">
      <div class="card">
        <h3 id="popTitle">ğŸ‰ Ù†Ø¬Ø§Ø­!</h3>
        <p id="popText"></p>
        <button class="ok" id="nextBtn">â¡ï¸ Ø§Ù„ØªØ§Ù„ÙŠ</button>
      </div>
    </div>

    <!-- Admin (?admin=1) -->
    <div class="admin" id="admin">
      <h3>ğŸ› ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h3>
      <div class="grid" id="adminScenes"></div>
      <div class="grid" style="margin-top:6px">
        <button onclick="simulateVote(1)">ğŸ¯ ØªØµÙˆÙŠØª 1</button>
        <button onclick="simulateVote(2)">ğŸ¯ ØªØµÙˆÙŠØª 2</button>
        <button onclick="simulateVote(3)">ğŸ¯ ØªØµÙˆÙŠØª 3</button>
        <button onclick="onGift('rose','Ù†ÙˆØ±')">ğŸŒ¹ Rose</button>
        <button onclick="onGift('gg','Ø£Ø­Ù…Ø¯')">ğŸ GG</button>
        <button onclick="onGift('fireworks','ÙØ§Ø·Ù…Ø©')">ğŸ‰ Fireworks</button>
        <button onclick="onGift('mic','Ø§Ù„Ù…Ø³ØªØ´Ø§Ø±')">ğŸ¤ Mic</button>
        <button onclick="triggerFever()">ğŸ”¥ Fever</button>
        <button onclick="simulateKeyword('Ø¨Ø±Ù‚')">âš¡ Ø¨Ø±Ù‚</button>
      </div>
    </div>
  </div>

  <script>
    /* ========= DATA ========= */
    const scenes = [
      { id:0, bg:"https://images.unsplash.com/photo-1542314831-068cd1dbfeeb?auto=format&fit=crop&w=2000&q=80", actor:"ğŸ‘¸",
        title:"Ø§Ù„Ù…Ø´Ù‡Ø¯ Ù¡: Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø£ÙÙ†ÙŠÙˆØ² Ø§Ù„Ø³Ø­Ø±ÙŠØ©",
        narr:"ğŸª© Ø£Ù‡Ù„Ø§Ù‹! Ø£Ù†Ø§ Ù†ÙˆØ±. Ø£Ù…Ø§Ù…Ù†Ø§ Ø§Ù„Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ù…Ø¶ÙŠØ¦Ø©â€”Ø§Ø®ØªØ§Ø±ÙˆØ§ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø±Ø­Ù„Ø©!",
        choices:[
          {id:1, text:"ğŸ—¡ï¸ Ø³Ù„Ø§Ø­ Ø§Ù„Ù…ÙˆÙ„", result:"ğŸ’« Ø§Ù„Ø³Ù„Ø§Ø­ ÙŠØªØ£Ù„Ù‚â€”Ø§Ù†Ø·Ù„Ù‚Øª Ø§Ù„Ù…ØºØ§Ù…Ø±Ø©!" },
          {id:2, text:"ğŸ›¡ï¸ Ø¯Ø±Ø¹ Ø§Ù„Ø£Ù…Ù†", result:"ğŸ›¡ï¸ Ø­Ù…Ø§ÙŠØ© Ù…Ù…ØªØ§Ø²Ø© Ù„Ù„Ù…Ù…Ø±Ø§Øª." },
          {id:3, text:"â˜• Ù‚Ù†Ø¨Ù„Ø© Ø§Ù„Ù‚Ù‡ÙˆØ©", result:"ğŸ’¥ Ø±Ø§Ø¦Ø­Ø© Ø§Ù„Ù‚Ù‡ÙˆØ© ØªÙØ±Ø¨Ùƒ Ø§Ù„ÙˆØ­ÙˆØ´." }
        ],
        correct:1
      },
      { id:1, bg:"https://images.unsplash.com/photo-1555529771-7888783a18d3?auto=format&fit=crop&w=2000&q=80", actor:"ğŸ‘¸",
        title:"Ø§Ù„Ù…Ø´Ù‡Ø¯ Ù¢: Ù‚Ø§Ø¹Ø© Ø¨Ø±ÙŠØ³ØªÙŠØ¬",
        narr:"ğŸ’ Ø¨Ø±ÙŠØ³ØªÙŠØ¬ ÙŠÙ„Ù…Ø¹â€¦ ÙˆÙˆØ­Ø´ Ø§Ù„Ø¹Ø·ÙˆØ± ÙŠÙ‡Ø§Ø¬Ù…!",
        choices:[
          {id:1, text:"ğŸ—¡ï¸ Ù‡Ø¬ÙˆÙ… Ø³Ø±ÙŠØ¹", result:"âš¡ ØªØ±Ø§Ø¬Ø¹ Ø§Ù„ÙˆØ­Ø´ ÙˆØ³Ø· Ø§Ù„Ù…Ø­Ù„Ø§Øª." },
          {id:2, text:"ğŸ›¡ï¸ Ø§Ù„Ø¯ÙØ§Ø¹", result:"ğŸ›¡ï¸ Ø­ØµØ§Ù†Ø© ÙˆØ±Ø§Ø¡ Ø§Ù„Ù…Ø¬ÙˆÙ‡Ø±Ø§Øª." },
          {id:3, text:"â˜• Ù‚Ù‡ÙˆØ© Ø§Ù„ØªØ´ØªÙŠØª", result:"ğŸ¯ Ø£Ø±Ø¨ÙƒØªÙ‡ Ø§Ù„Ø±Ø§Ø¦Ø­Ø©â€”ØªÙ‚Ø¯Ù‘Ù…!" }
        ],
        correct:1
      },
      { id:2, bg:"https://images.unsplash.com/photo-1581091226033-d5c48150dbaa?auto=format&fit=crop&w=2000&q=80", actor:"ğŸ‘¸",
        title:"Ø§Ù„Ù…Ø´Ù‡Ø¯ Ù£: Ø­Ø¯Ø§Ø¦Ù‚ Ø§Ù„Ø£ÙÙ†ÙŠÙˆØ²",
        narr:"ğŸŒ¿ ØªÙ†ÙŠÙ† Ø§Ù„Ø£ÙˆØ±Ø§Ù‚ ÙŠØ¸Ù‡Ø± Ø¨ÙŠÙ† Ø§Ù„Ø£Ø´Ø¬Ø§Ø±!",
        choices:[
          {id:1, text:"ğŸ—¡ï¸ Ù‚Ø·Ø¹ Ø§Ù„Ø£ÙˆØ±Ø§Ù‚", result:"ğŸƒ Ø§Ù„ØªÙ†ÙŠÙ† ÙŠØªØ±Ø§Ø¬Ø¹ Ù„Ù„Ù†Ø§ÙÙˆØ±Ø©." },
          {id:2, text:"ğŸ›¡ï¸ Ø¯Ø±Ø¹ Ø§Ù„Ø·Ø¨ÙŠØ¹Ø©", result:"ğŸŒ³ Ø£ÙˆØ±Ø§Ù‚ ØªØªØ³Ø§Ù‚Ø· Ø­ÙˆÙ„Ùƒ." },
          {id:3, text:"â˜• Ù‚Ù‡ÙˆØ© Ø§Ù„ÙˆØ±ÙˆØ¯", result:"ğŸŒ¹ Ø§Ø±ØªØ¨Ø§Ùƒ Ø³Ø±ÙŠØ¹â€”Ø§ÙØªØ­ Ø§Ù„Ø·Ø±ÙŠÙ‚." }
        ],
        correct:1
      },
      { id:3, bg:"https://images.unsplash.com/photo-1441986300917-64674bd600d8?auto=format&fit=crop&w=2000&q=80", actor:"ğŸ‘¸",
        title:"Ø§Ù„Ù…Ø´Ù‡Ø¯ Ù¤: Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ",
        narr:"ğŸ›ï¸ ÙˆØ­ÙˆØ´ Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø®Ø§ØµØ© Ù…Ù† ÙƒÙ„ Ø§ØªØ¬Ø§Ù‡!",
        choices:[
          {id:1, text:"ğŸ—¡ï¸ Ù‡Ø¬ÙˆÙ… Ø¯Ø§Ø¦Ø±ÙŠ", result:"ğŸŒ€ Ø§Ù„ØªÙØ§Ù Ù…Ù…ØªØ§Ø² Ø¨ÙŠÙ† Ø§Ù„Ù…Ø­Ù„Ø§Øª." },
          {id:2, text:"ğŸ›¡ï¸ Ø¯Ø±Ø¹ Ø§Ù„ØªØ³ÙˆÙ‚", result:"ğŸ›’ Ø¹Ø±Ø¨Ø§Øª ÙƒØ¯Ø±Ø¹ Ø°ÙƒÙŠ." },
          {id:3, text:"â˜• Ù‚Ù‡ÙˆØ© Ø§Ù„ØªÙ†Ø²ÙŠÙ„Ø§Øª", result:"ğŸ·ï¸ Ø§Ù†Ø¬Ø°Ø¨ÙˆØ§ Ù„Ù„Ø¹Ø±ÙˆØ¶." }
        ],
        correct:1
      },
      { id:4, bg:"https://images.unsplash.com/photo-1490481651871-ab68de25d43d?auto=format&fit=crop&w=2000&q=80", actor:"ğŸ‘¸",
        title:"Ø§Ù„Ù…Ø´Ù‡Ø¯ Ù¥: Ø³Ø§Ø­Ø© Ø§Ù„Ù…Ù†ØªØ¯Ù‰",
        narr:"ğŸ­ Ø§Ù„Ø¬Ù…ÙŠØ¹ ÙŠØ´Ø§Ù‡Ø¯â€”ÙˆØ­Ø´ Ø§Ù„Ø¬Ù…Ù‡ÙˆØ± ÙŠÙ‡Ø¬Ù… Ù…Ù† Ø§Ù„Ù…Ù†ØµØ©!",
        choices:[
          {id:1, text:"ğŸ—¡ï¸ Ù‡Ø¬ÙˆÙ… Ø¬Ù…Ø§Ù‡ÙŠØ±ÙŠ", result:"ğŸ‘ ØªØµÙÙŠÙ‚ Ù…Ø¯ÙˆÙ!" },
          {id:2, text:"ğŸ›¡ï¸ Ø¯Ø±Ø¹ Ø§Ù„Ø´Ù‡Ø±Ø©", result:"ğŸŒŸ Ø§Ø±ØªØ¨Ø§Ùƒ Ø¹Ù†Ø¯ Ø§Ù„ÙˆØ­Ø´." },
          {id:3, text:"â˜• Ù‚Ù‡ÙˆØ© Ø§Ù„Ù†Ø¬ÙˆÙ…", result:"ğŸ¬ Ø§Ù†Ø³Ø­Ø§Ø¨ Ø³Ø±ÙŠØ¹." }
        ],
        correct:1
      },
      { id:5, bg:"https://images.unsplash.com/photo-1491553895911-0055eca6402d?auto=format&fit=crop&w=2000&q=80", actor:"ğŸ‘¸",
        title:"Ø§Ù„Ù…Ø´Ù‡Ø¯ Ù¦: Ù…ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø¯ÙŠØ±",
        narr:"ğŸ‘‘ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ! Ø§Ù„Ù…Ø¯ÙŠØ± ÙŠØ­Ø±Ø³ Ø§Ù„ÙƒÙ†ÙˆØ²â€”Ø§Ø®ØªØ§Ø±ÙˆØ§ Ø¨Ø­ÙƒÙ…Ø©â€¦",
        choices:[
          {id:1, text:"ğŸ—¡ï¸ Ø§Ù„Ù‡Ø¬ÙˆÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ", result:"ğŸŠ Ù‡ÙØ²Ù… Ø§Ù„Ù…Ø¯ÙŠØ± ÙˆØ£ÙØ¹ÙŠØ¯Øª Ø§Ù„ÙƒÙ†ÙˆØ²!" },
          {id:2, text:"ğŸ›¡ï¸ Ø§Ù„Ø¯ÙØ§Ø¹ Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠ", result:"ğŸ›¡ï¸ Ù‚ÙˆÙŠ Ù„ÙƒÙ†Ù‡ Ù…Ø§ Ø²Ø§Ù„ Ù…Ø³ÙŠØ·Ø±." },
          {id:3, text:"â˜• Ù‚Ù‡ÙˆØ© Ø§Ù„Ù…ÙØ§ÙˆØ¶Ø§Øª", result:"â˜• Ù„Ø§ ÙŠÙ‡ØªÙ…â€”Ø§Ù„Ù‡Ø¬ÙˆÙ… Ø¶Ø±ÙˆØ±ÙŠ." }
        ],
        correct:1, boss:true
      }
    ];

    /* ========= STATE ========= */
    const root   = document.getElementById('root');
    const bgA    = document.getElementById('bgA');
    const bgB    = document.getElementById('bgB');
    const sceneTitle = document.getElementById('sceneTitle');
    const actor  = document.getElementById('actor');
    const narr   = document.getElementById('narr');
    const choicesEl = document.getElementById('choices');
    const timerEl= document.getElementById('timer');
    const popup  = document.getElementById('popup');
    const popTitle = document.getElementById('popTitle');
    const popText  = document.getElementById('popText');
    const nextBtn  = document.getElementById('nextBtn');

    const hypeFill = document.getElementById('hypeFill');
    const hypePct  = document.getElementById('hypePct');

    const bar1 = document.getElementById('bar1');
    const bar2 = document.getElementById('bar2');
    const bar3 = document.getElementById('bar3');
    const bossBox = document.getElementById('bossBox');
    const bossHPBar = document.getElementById('bossHPBar');
    const ticker = document.getElementById('ticker');
    const fx = document.getElementById('fx');
    const sudden = document.getElementById('sudden');

    const admin = document.getElementById('admin');
    const adminScenes = document.getElementById('adminScenes');
    const qs = new URLSearchParams(location.search);
    if(qs.get('admin')==='1') admin.style.display='block';

    // Audio scaffold (replace sources with your files)
    const SFX = {
      tick:new Audio('sfx/tick.mp3'),
      win:new Audio('sfx/win.mp3'),
      lose:new Audio('sfx/lose.mp3'),
      fever:new Audio('sfx/fever.mp3')
    };

    let current=0, usingA=true;
    let votes = {1:0,2:0,3:0};
    let timer=null, timeLeft=30;
    let hype=0, combo=0, fever=false;
    let bossHP=100;
    let oneTimeShield=false;
    let advisor=null, advisorUntil=0, advisorMult=2;
    const RUNS_KEY='ad_runs'; let runs = Number(localStorage.getItem(RUNS_KEY)||0);
    document.getElementById('runs').textContent = runs;

    /* ========= HELPERS ========= */
    function setBG(url){
      const currentBG = usingA?bgA:bgB;
      const nextBG = usingA?bgB:bgA;
      const img = new Image();
      img.onload = ()=>{
        nextBG.style.backgroundImage = `url('${url}')`;
        nextBG.style.opacity = 1;
        currentBG.style.opacity = 0;
        usingA = !usingA;
      };
      img.src = url;
    }
    function fmtTime(s){const mm=String(Math.floor(s/60)).padStart(2,'0'); const ss=String(s%60).padStart(2,'0'); return `${mm}:${ss}`;}
    function updateTimer(){timerEl.textContent = `â±ï¸ ${fmtTime(timeLeft)}`;}
    function updateMeters(){
      const total = votes[1]+votes[2]+votes[3] || 1;
      bar1.style.width = (votes[1]/total*100).toFixed(1)+'%';
      bar2.style.width = (votes[2]/total*100).toFixed(1)+'%';
      bar3.style.width = (votes[3]/total*100).toFixed(1)+'%';
    }
    function resetVotes(){votes={1:0,2:0,3:0}; updateMeters();}
    function renderBoss(){ bossBox.style.display = scenes[current].boss ? 'block':'none'; bossHPBar.style.width = bossHP+'%'; }
    function addHype(n){ hype = Math.min(100, hype + n); hypeFill.style.width = hype+'%'; hypePct.textContent = Math.round(hype)+'%'; if(hype>=100 && !fever) triggerFever(); }
    function triggerFever(){ fever=true; document.body.dataset.fever="1"; SFX.fever?.play?.(); setTimeout(()=>{ fever=false; document.body.dataset.fever="0"; hype=0; hypeFill.style.width='0%'; hypePct.textContent='0%'; },15000); }
    function shake(sel){ const el=document.querySelector(sel); el.classList.add('shake'); setTimeout(()=>el.classList.remove('shake'),500); }
    function flash(){ const f=document.createElement('div'); f.style="position:absolute;inset:0;background:#fff;opacity:.6;z-index:1200;"; root.appendChild(f); setTimeout(()=>f.remove(),120); }
    function sparks(x,y){ for(let i=0;i<15;i++){ const p=document.createElement('div'); p.className='spark'; p.style.left=x+'px'; p.style.top=y+'px'; const ang=Math.random()*Math.PI*2; const dist=50+Math.random()*100; p.style.setProperty('--tx',Math.cos(ang)*dist+'px'); p.style.setProperty('--ty',Math.sin(ang)*dist+'px'); fx.appendChild(p); setTimeout(()=>p.remove(),1000); } }
    function confetti(){ const rect=root.getBoundingClientRect(); for(let i=0;i<40;i++){ const c=document.createElement('div'); c.className='conf'; c.style.color = ['#8b5cf6','#6366f1','#f59e0b','#10b981'][i%4]; c.style.left = (rect.width*0.5)+'px'; c.style.top = '0px'; c.style.setProperty('--tx',(Math.random()*rect.width - rect.width/2)+'px'); c.style.setProperty('--ty',(rect.height*0.9)+'px'); c.style.setProperty('--rot',(Math.random()*360)+'deg'); fx.appendChild(c); setTimeout(()=>c.remove(),900); } }

    /* ========= TICKER ========= */
    const prompts = [
      "Ø§ÙƒØªØ¨ÙˆØ§ <b>Ø³ÙŠÙ</b> / <b>Ø¯Ø±Ø¹</b> / <b>Ù‚Ù‡ÙˆØ©</b> Ù„Ø§Ø®ØªÙŠØ§Ø±ÙƒÙ…!",
      "Ø£ÙˆÙ„ Ù…ØªØ¨Ø±Ø¹ Ø§Ù„Ø¢Ù† = <b>Ø§Ù„Ù…Ø³ØªØ´Ø§Ø±</b> Ù„Ù…Ø¯Ø© Ù£Ù  Ø«Ø§Ù†ÙŠØ© (ØµÙˆØªÙ‡ Ã—Ù¢)!",
      "ØªØ¹Ø§Ø¯Ù„ØŸ Ø§ÙƒØªØ¨ÙˆØ§ <b>Ø¨Ø±Ù‚</b> Ù„ÙƒØ³Ø± Ø§Ù„ØªØ¹Ø§Ø¯Ù„!",
      "Ø§Ø±ÙØ¹ÙˆØ§ Ø§Ù„Ù‡Ø§ÙŠØ¨ Ù„ØªØ´ØºÙŠÙ„ <b>Fever Time</b> ğŸ”¥"
    ];
    let pIndex=0;
    setInterval(()=>{ pIndex=(pIndex+1)%prompts.length; ticker.innerHTML=prompts[pIndex]; },5000);

    /* ========= TIMER / SUDDEN DEATH ========= */
    function startTimer(s=30){
      clearInterval(timer);
      timeLeft=s; updateTimer();
      let suddenShown=false;
      timer=setInterval(()=>{
        if(timeLeft<=0){
          clearInterval(timer);
          const top = topVoted() ?? 1;
          makeChoice(top,true); return;
        }
        timeLeft--; updateTimer();

        // last 10s tick
        if(timeLeft===10) SFX.tick?.play?.();
        if(timeLeft<10 && timeLeft%2===0) SFX.tick?.play?.();

        // Sudden Death (<=3s and tie or zero)
        const tied = isTie();
        if(timeLeft<=3 && tied && !suddenShown){
          sudden.classList.add('show'); suddenShown=true;
        }
        if(!tied){ sudden.classList.remove('show'); }
      },1000);
    }
    function isTie(){
      const arr=[votes[1],votes[2],votes[3]];
      const max=Math.max(...arr);
      const countMax = arr.filter(v=>v===max).length;
      return max===0 || countMax>1;
    }
    function simulateKeyword(word){
      if(word==='Ø¨Ø±Ù‚' && timeLeft<=3){ // break tie by adding 1 to random tied
        const arr=[{id:1,v:votes[1]},{id:2,v:votes[2]},{id:3,v:votes[3]}];
        const max=Math.max(votes[1],votes[2],votes[3]);
        const tied=arr.filter(o=>o.v===max);
        const pick = tied[Math.floor(Math.random()*tied.length)]?.id || 1;
        votes[pick]+=1; updateMeters();
      }
    }

    /* ========= ADMIN ========= */
    function buildAdmin(){
      adminScenes.innerHTML='';
      scenes.forEach((s,i)=>{ const b=document.createElement('button'); b.textContent=`Ø§Ù„Ù…Ø´Ù‡Ø¯ ${i+1}: ${s.title.replace(/Ø§Ù„Ù…Ø´Ù‡Ø¯ \\d+:\\s?/,'')}`; b.onclick=()=>loadScene(i,true); adminScenes.appendChild(b); });
    }
    buildAdmin();

    /* ========= BUILD SCENE ========= */
    function loadScene(i, fromAdmin=false){
      if(i>=scenes.length) i=0;
      current=i; resetVotes(); combo=0; oneTimeShield=false;
      const s=scenes[i];
      setBG(s.bg);
      sceneTitle.textContent = s.title;
      actor.textContent = s.actor;
      narr.textContent = s.narr;
      choicesEl.innerHTML='';
      s.choices.forEach(ch=>{
        const btn=document.createElement('button');
        btn.className='btn';
        const [icon,...label]=ch.text.split(' ');
        btn.innerHTML = `<span class="icon">${icon}</span><span class="text">${label.join(' ')}</span>`;
        btn.dataset.choice=ch.id;
        btn.onclick=()=> makeChoice(ch.id);
        choicesEl.appendChild(btn);
      });
      if(s.boss){ bossHP=100; } renderBoss();
      popup.style.display='none';
      startTimer( (s.boss && fever)?20:30 ); // example: same timer; adjust if needed
    }

    /* ========= VOTING & RESULT ========= */
    function simulateVote(id, username=null){
      if(!timer) return;
      const mult = (advisor && Date.now()<advisorUntil && username===advisor) ? advisorMult : 1;
      votes[id] += 1*mult + Math.floor(Math.random()*2); // tiny burst
      updateMeters();

      const btn = choicesEl.querySelector(`[data-choice="${id}"]`);
      if(btn){ pulse(btn); buttonSparks(btn); }
      addHype(4);
    }
    function pulse(el){ el.animate([{transform:'scale(1)'},{transform:'scale(1.05)'},{transform:'scale(1)'}],{duration:180}); }
    function buttonSparks(btn){
      const container=root.getBoundingClientRect();
      const r=btn.getBoundingClientRect();
      const x=r.left+r.width/2-container.left;
      const y=r.top+r.height/2-container.top;
      sparks(x,y);
    }
    function topVoted(){
      const arr=[{id:1,v:votes[1]},{id:2,v:votes[2]},{id:3,v:votes[3]}].sort((a,b)=>b.v-a.v);
      return arr[0].v>0 ? arr[0].id : null;
    }

    function makeChoice(choiceId, auto=false){
      if(!timer) return;
      clearInterval(timer);
      const s=scenes[current];
      const choice=s.choices.find(c=>c.id===choiceId);
      const correct = (choiceId===s.correct) || (oneTimeShield && (oneTimeShield=false, true));

      // UI
      const btn=choicesEl.querySelector(`[data-choice="${choiceId}"]`);
      if(btn){ btn.classList.add('selected'); buttonSparks(btn); }
      if(correct){
        combo++; addHype(7+combo*1);
        flash();
        SFX.win?.play?.();
      }else{
        combo=0; shake('#root');
        SFX.lose?.play?.();
      }

      // Boss damage via correct or gifts
      if(s.boss && correct){
        damageBoss(35); // chunk from correct
      }

      // show popup
      setTimeout(()=>{
        popTitle.textContent = correct ? 'ğŸ‰ Ù†Ø¬Ø§Ø­!' : 'ğŸ’¡ Ù…Ø­Ø§ÙˆÙ„Ø© Ø¬ÙŠØ¯Ø©';
        popTitle.style.color = correct ? '#10b981' : '#f59e0b';
        popText.textContent = choice?.result || '';
        popup.style.display='flex';
      },600);
    }

    function nextScene(){
      if(current===scenes.length-1){ // run end
        runs++; localStorage.setItem(RUNS_KEY,String(runs)); document.getElementById('runs').textContent=runs;
      }
      loadScene(current+1);
    }
    nextBtn.addEventListener('click', nextScene);

    /* ========= BOSS ========= */
    function damageBoss(n){
      if(!scenes[current].boss) return;
      bossHP=Math.max(0,bossHP-n); renderBoss();
      if(bossHP===0){
        // Auto mark as success on boss down
        setTimeout(()=>makeChoice(scenes[current].correct,true),200);
      }
    }

    /* ========= GIFTS & ROLES =========
       Map your live events to onGift(type, user)
       rose -> +3 to choice 1, gg -> +3 to choice 2,
       fireworks -> +3 to choice 3 + confetti, mic -> oneTimeShield
    */
    function onGift(type, user='Ù…Ø´Ø§Ù‡Ø¯'){
      if(!timer) return;
      switch(type){
        case 'rose': for(let i=0;i<3;i++) simulateVote(1,user); addHype(5); break;
        case 'gg': for(let i=0;i<3;i++) simulateVote(2,user); addHype(5); break;
        case 'fireworks': for(let i=0;i<3;i++) simulateVote(3,user); confetti(); addHype(10); break;
        case 'mic':
          oneTimeShield=true;
          toast(`ğŸ™ï¸ Ø¨Ø±ÙƒØ© ${user}! Ø§Ù„Ø®Ø·Ø£ Ø§Ù„Ù‚Ø§Ø¯Ù… Ù…Ø­Ø³ÙˆØ¨ ØµØ­.`); break;
      }
      // boss chip from big gifts
      if(type==='fireworks' && scenes[current].boss) damageBoss(12);
      // first gift in scene becomes advisor if none
      if(!advisor){ setAdvisor(user, 30_000); }
    }

    function setAdvisor(user, ms){
      advisor=user; advisorUntil=Date.now()+ms;
      toast(`ğŸ‘‘ ${user} ØµØ§Ø± <b>Ø§Ù„Ù…Ø³ØªØ´Ø§Ø±</b> (${Math.round(ms/1000)}s) â€” ØµÙˆØªÙ‡ Ã—${advisorMult}`);
      setTimeout(()=>{ if(Date.now()>=advisorUntil) { toast(`âŒ› Ø§Ù†ØªÙ‡Øª ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù…Ø³ØªØ´Ø§Ø± ${advisor}`); advisor=null; } }, ms+200);
    }

    /* ========= TOAST ========= */
    function toast(html){
      const t=document.createElement('div');
      t.style.cssText="position:absolute;top:120px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,.8);padding:8px 12px;border:1px solid #8b5cf6;border-radius:10px;z-index:1500";
      t.innerHTML=html; root.appendChild(t); setTimeout(()=>t.remove(),2000);
    }

    /* ========= PUBLIC / INIT ========= */
    window.loadScene = loadScene;
    window.simulateVote = simulateVote;
    window.onGift = onGift;
    window.simulateKeyword = simulateKeyword;
    window.triggerFever = triggerFever;

    document.addEventListener('DOMContentLoaded', ()=>{
      loadScene(0);
    });
  </script>
</body>
</html>
