<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Avenues & Dragons</title>

  <!-- kill aggressive caching on iPad/Safari -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">

  <style>
    :root { --bg:#0d0b1a; --card:#1b1630; --ink:#fff; --muted:#9aa0b3; --accent:#7057ff; }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;background:radial-gradient(1200px 700px at 50% -10%,#1a1530 0%,#0d0b1a 60%,#090815 100%);
         color:var(--ink);font-family:system-ui,-apple-system,"Tajawal",sans-serif;
         display:flex;align-items:center;justify-content:center}
    .card{width:min(92vw,760px);background:linear-gradient(180deg, #211a3b 0%, #17142a 100%);
          border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,.45);padding:28px}
    .title{font-size:26px;font-weight:800;text-align:center;letter-spacing:.3px}
    .prompt{margin:18px 0 22px;text-align:center;color:var(--muted);min-height:28px}
    .row{display:flex;gap:16px;flex-wrap:wrap;justify-content:center}
    .opt{flex:1 1 300px;background:#2a2346;border:1px solid rgba(255,255,255,.05);
         border-radius:14px;padding:18px 20px;text-align:center;font-size:18px;font-weight:700;
         outline:none;cursor:pointer;box-shadow:0 10px 24px rgba(0,0,0,.25)}
    .opt:active{transform:scale(.99)}
    .status{margin-top:12px;text-align:center;color:var(--muted);font-size:13px}
  </style>
</head>
<body>
  <div class="card">
    <div class="title">Avenues & Dragons</div>
    <div id="question" class="prompt">–</div>
    <div class="row">
      <button id="a" class="opt">–</button>
      <button id="b" class="opt">–</button>
    </div>
    <div id="status" class="status">بانتظار الاتصال…</div>
  </div>

  <script>
    // ▼ If your JSON lives elsewhere, change this ONCE to that full URL.
    // Keep it as-is if choices.json is in the same site.
    const DATA_URL = 'choices.json';

    const els = {
      q: document.getElementById('question'),
      a: document.getElementById('a'),
      b: document.getElementById('b'),
      s: document.getElementById('status')
    };

    let last = '';

    async function pull() {
      try {
        // Always bypass cache; you never have to add anything manually.
        const url = DATA_URL + (DATA_URL.includes('?') ? '&' : '?') + 'ts=' + Date.now();
        const res = await fetch(url, { cache: 'no-store' });
        if (!res.ok) throw new Error(res.status);
        const data = await res.json();

        // Expecting: { "question": "...", "a": "...", "b": "..." }
        const key = JSON.stringify(data);
        if (key !== last) {
          els.q.textContent = data.question || '–';
          els.a.textContent = data.a || '–';
          els.b.textContent = data.b || '–';
          last = key;
        }
        els.s.textContent = 'متصل • يتم التحديث تلقائيًا';
      } catch (e) {
        els.s.textContent = 'لا يوجد اتصال (سيُعاد المحاولة)…';
      }
    }

    // First load, then poll every 2 seconds.
    pull();
    setInterval(pull, 2000);

    // Optional: unregister any old service worker that might be caching
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.getRegistrations().then(rs => rs.forEach(r => r.unregister()));
    }
  </script>
</body>
</html>
