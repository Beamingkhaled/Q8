<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Avenues & Dragons</title>
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;800&display=swap" rel="stylesheet">

  <style>
    /* ======== THEME — tweak these only if you want ======== */
    :root{
      --ink:#ffffff;
      --muted:#b9bfd2;

      /* Box style: set to 1 for glass, 0 for solid */
      --glass: 1;

      /* Colors for solid mode */
      --card-start:#291e54;   /* top of gradient */
      --card-end:#1a1536;     /* bottom of gradient */

      /* Colors for glass mode */
      --glass-bg: rgba(22, 18, 40, 0.36);
      --glass-border: rgba(255,255,255,0.18);
      --glass-backdrop: blur(14px);

      /* Accent glow on hover (subtle) */
      --glow: rgba(120,90,255,0.35);

      /* Sizes */
      --radius: 20px;
      --pad: 28px;
      --shadow: 0 24px 70px rgba(0,0,0,.45);

      /* Background overlay on top of video (0 = none, 1 = full) */
      --overlay: rgba(6, 4, 18, 0.50);
      /* Optional vignette */
      --vignette: radial-gradient(1200px 700px at 50% -10%, rgba(0,0,0,0.18) 0%, rgba(0,0,0,0.55) 60%, rgba(0,0,0,0.75) 100%);
    }

    /* ======== Base ======== */
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--ink);
      font-family:'Tajawal', system-ui, -apple-system, sans-serif;
      display:flex;align-items:center;justify-content:center;
      overflow:hidden;
      background:#0b0a15;
    }

    /* ======== Background video + overlay ======== */
    .bg-wrap{
      position:fixed; inset:0; z-index:-2; overflow:hidden;
    }
    .bg-wrap video{
      position:absolute;
      min-width:100vw; min-height:100vh;
      width:auto; height:auto; object-fit:cover;
      top:50%; left:50%; transform:translate(-50%,-50%);
      filter:brightness(0.9) saturate(1.05);
    }
    .bg-overlay{
      position:fixed; inset:0; z-index:-1;
      background: var(--overlay);
      pointer-events:none;
    }
    .bg-vignette{
      position:fixed; inset:0; z-index:-1;
      background: var(--vignette);
      pointer-events:none;
    }

    /* ======== Card ======== */
    .card{
      width:min(92vw,800px);
      padding:var(--pad);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      backdrop-filter: var(--glass) calc(var(--glass) * 1px) ? var(--glass-backdrop) : none;
    }
    /* solid */
    .card{
      background: linear-gradient(180deg, var(--card-start) 0%, var(--card-end) 100%);
      border: none;
    }
    /* glass modifier (applied via JS when --glass==1) */
    .glass{
      background: var(--glass-bg) !important;
      border: 1px solid var(--glass-border) !important;
      backdrop-filter: var(--glass-backdrop) !important;
    }

    .title{font-size:28px;font-weight:800;text-align:center;letter-spacing:.2px}
    .q{margin:18px 0 22px;text-align:center;color:var(--muted);min-height:28px;font-size:18px}

    .row{display:flex;gap:16px;flex-wrap:wrap;justify-content:center}
    .opt{
      flex:1 1 320px;
      border-radius:14px;
      padding:18px 20px;
      text-align:center;
      font-size:18px;font-weight:800;
      cursor:default;
      transition: box-shadow .18s ease, transform .18s ease, background .18s ease, border-color .18s ease;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(34, 28, 60, 0.65);
      backdrop-filter: blur(8px);
      box-shadow: 0 10px 28px rgba(0,0,0,.28);
    }
    .opt:hover{ box-shadow: 0 14px 34px var(--glow); transform: translateY(-1px); }
    .s{margin-top:14px;text-align:center;color:var(--muted);font-size:13px}
  </style>
</head>
<body>
  <!-- Background video -->
  <div class="bg-wrap">
    <video id="bg" preload="auto" autoplay muted loop playsinline poster="">
      <source id="bgsrc" src="" type="video/mp4">
    </video>
  </div>
  <div class="bg-overlay"></div>
  <div class="bg-vignette"></div>

  <!-- UI -->
  <div id="card" class="card">
    <div class="title">Avenues & Dragons</div>
    <div id="q" class="q">–</div>
    <div class="row">
      <div id="a" class="opt">–</div>
      <div id="b" class="opt">–</div>
    </div>
    <div id="s" class="s">بانتظار الاتصال…</div>
  </div>

  <script>
    /* ========= CONFIG (edit only if needed) ========= */
    // 1) Your video file: place bg.mp4 next to index.html OR put a full MP4 URL here
    const VIDEO_SRC = 'bg.mp4'; // e.g. 'https://your.cdn/avenues.mp4'

    // 2) If you want to force GLASS style, leave as true; for solid gradient set false
    const FORCE_GLASS = true; // true = glassmorphism card, false = solid gradient

    // 3) JSONBin auto-detect from ?bin=… with fallback to your shown bin
    const params = new URLSearchParams(location.search);
    const bin = params.get('bin') || '690fb624d0ea881f40dc579f';
    const BASE = `https://api.jsonbin.io/v3/b/${bin}/latest`;

    // ====== Apply video ======
    (function setVideo(){
      const v = document.getElementById('bg');
      const s = document.getElementById('bgsrc');
      if (VIDEO_SRC) { s.src = VIDEO_SRC; v.load(); }
      // iOS requires muted+playsinline for autoplay; both set on tag
    })();

    // ====== Apply card style ======
    (function styleCard(){
      if (FORCE_GLASS){
        document.getElementById('card').classList.add('glass');
      }
    })();

    // ====== Data polling (supports both key styles) ======
    const els = { q: document.getElementById('q'), a: document.getElementById('a'), b: document.getElementById('b'), s: document.getElementById('s') };
    let last = '';

    function normalize(rec){
      const r = rec && rec.record ? rec.record : rec || {};
      return {
        question: r.question ?? r.title ?? '–',
        a: r.a ?? r.left ?? '–',
        b: r.b ?? r.right ?? '–'
      };
    }

    async function pull(){
      try{
        const t = Date.now();
        let res = await fetch(`${BASE}?meta=false&ts=${t}`, { cache: 'no-store' });
        let data = await res.json();
        if (!res.ok) throw new Error('bad');
        const next = normalize(data);
        const key = JSON.stringify(next);
        if (key !== last){
          els.q.textContent = next.question || '–';
          els.a.textContent = next.a || '–';
          els.b.textContent = next.b || '–';
          last = key;
        }
        els.s.textContent = 'متصل • يتم التحديث تلقائيًا';
      } catch(e){
        try{
          const t2 = Date.now();
          const res2 = await fetch(`${BASE}?ts=${t2}`, { cache: 'no-store' });
          const data2 = await res2.json();
          const next2 = normalize(data2);
          const key2 = JSON.stringify(next2);
          if (key2 !== last){
            els.q.textContent = next2.question || '–';
            els.a.textContent = next2.a || '–';
            els.b.textContent = next2.b || '–';
            last = key2;
          }
          els.s.textContent = 'متصل • يتم التحديث تلقائيًا';
        } catch(e2){
          els.s.textContent = 'لا يوجد اتصال (سيُعاد المحاولة)…';
        }
      }
    }
    pull(); setInterval(pull, 1500);
  </script>
</body>
</html>
