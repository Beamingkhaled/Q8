<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ø£ÙÙŠÙ†ÙˆØ² ÙˆØ§Ù„ØªÙ†Ø§Ù†ÙŠÙ† - Avenues & Dragons</title>

    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html, body { height: 100%; overflow: hidden; }
        body {
            font-family: "Tajawal", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
            background: #000;
            color: #fff;
        }

        /* ---------- Background video ---------- */
        #bg-video {
            position: fixed;
            top: 50%;
            left: 50%;
            min-width: 100%;
            min-height: 100%;
            width: auto;
            height: auto;
            z-index: -3;
            transform: translate(-50%, -50%);
            object-fit: cover;
            filter: brightness(55%);
        }

        .vignette {
            position: fixed;
            inset: 0;
            z-index: -2;
            pointer-events: none;
            background: radial-gradient(120% 120% at 50% 50%, rgba(0,0,0,0) 40%, rgba(0,0,0,0.25) 100%);
        }

        /* ---------- Setup overlay ---------- */
        .setup-overlay {
            position: fixed;
            inset: 0;
            z-index: 9999;
            background: rgba(0,0,0,0.75);
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 24px;
        }

        .setup-inner {
            width: min(92vw, 640px);
            max-height: calc(100dvh - 48px);
            overflow: auto;
            border-radius: 20px;
            background: #fff8dc;
            color: #2b2b2b;
            border: 2px solid #ffc107;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            padding: 22px;
        }

        .setup-title {
            color: #8a6d00;
            font-size: 22px;
            font-weight: 800;
            text-align: center;
            margin-bottom: 10px;
        }

        .setup-desc {
            color: #8a6d00;
            text-align: center;
            margin: 6px 0 12px 0;
            font-size: 14px;
        }

        .setup-label {
            display: block;
            margin-top: 12px;
            margin-bottom: 6px;
            color: #8a6d00;
            font-weight: 700;
        }

        .setup-input {
            width: 100%;
            padding: 14px;
            border: 2px solid #ffc107;
            border-radius: 10px;
            background: #fff;
            font-family: monospace;
            font-size: 16px;
        }

        .setup-actions {
            display: flex;
            gap: 10px;
            margin-top: 16px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .setup-button-save {
            padding: 14px 24px;
            border: 0;
            border-radius: 10px;
            font-weight: 800;
            cursor: pointer;
            background: #28a745;
            color: white;
        }

        .setup-button-reset {
            padding: 14px 24px;
            border: 0;
            border-radius: 10px;
            font-weight: 800;
            cursor: pointer;
            background: #eeeeee;
            color: #333333;
        }

        .hidden { display: none !important; }

        /* ---------- Card overlay ---------- */
        .game-wrap {
            position: fixed;
            inset: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 24px;
            z-index: 10;
        }

        .card {
            width: min(92vw, 720px);
            background: rgba(10,10,16,0.65);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 22px;
            border: 1px solid rgba(255,255,255,0.08);
            box-shadow:
                0 10px 40px rgba(0,0,0,0.5),
                inset 0 0 0 1px rgba(255,255,255,0.03);
            padding: 26px 22px 32px;
        }

        .title {
            font-weight: 800;
            letter-spacing: .5px;
            font-size: clamp(22px, 5.2vw, 38px);
            text-align: center;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #7D5EFF, #9A68FF);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .question {
            text-align: center;
            color: #d9d9e6;
            font-size: clamp(16px, 4.2vw, 22px);
            margin: 4px auto 18px;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .question.updating { animation: pulse 0.5s ease; }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .choices { display: grid; gap: 16px; }

        .choice { position: relative; }

        .choice.hidden { display: none; }

        .choice::before {
            content: attr(data-sticker);
            position: absolute;
            top: -10px;
            left: 10px;
            padding: 8px 14px;
            background: rgba(255,255,255,0.16);
            color: #fff;
            border-radius: 12px;
            backdrop-filter: blur(6px);
            -webkit-backdrop-filter: blur(6px);
            font-weight: 800;
            font-size: 14px;
            border: 1px solid rgba(255,255,255,0.25);
            box-shadow: 0 4px 14px rgba(0,0,0,0.35);
            z-index: 1;
        }

        .btn {
            width: 100%;
            border: 0;
            outline: 0;
            border-radius: 18px;
            padding: 18px 20px;
            text-align: center;
            font-weight: 700;
            font-size: clamp(16px, 4.4vw, 22px);
            color: #e9e7ff;
            cursor: default;
            background: linear-gradient(180deg, #0d0d15, #12121c);
            box-shadow:
                0 0 0 1px rgba(125,94,255,0.25) inset,
                0 0 14px rgba(125,94,255,0.45),
                0 0 50px rgba(125,94,255,0.28);
            position: relative;
            transition: all 0.3s ease;
        }

        .btn::after {
            content: "";
            position: absolute;
            inset: 0;
            border-radius: 18px;
            padding: 1px;
            background: linear-gradient(90deg, #7D5EFF, #9A68FF, #7D5EFF);
            -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            opacity: .9;
        }

        .btn.updating { animation: pulse 0.5s ease; }

        .status {
            text-align: center;
            margin-top: 16px;
            color: #bdb8ff;
            font-size: 14px;
            opacity: .85;
            padding: 8px;
            border-radius: 8px;
        }

        .status.connected { color: #10b981; }
        .status.updating { color: #f59e0b; font-weight: 600; }
        .status.error { color: #ef4444; }

        @media (max-width: 480px) {
            .choice::before { top: -12px; left: 8px; font-size: 13px; }
            .btn { padding: 16px 16px; border-radius: 16px; }
            .btn::after { border-radius: 16px; }
        }
    </style>
</head>
<body>

    <!-- ---------- Video Background ---------- -->
    <video id="bg-video" autoplay muted loop playsinline>
        <source src="https://res.cloudinary.com/dkaldddme/video/upload/f_auto,q_auto/v1/copy_CDC85CC8-6581-4C3F-B5E2-46DC4C3A0C86_b2infi.mp4" type="video/mp4">
    </video>
    <div class="vignette"></div>

    <!-- ---------- Setup Overlay ---------- -->
    <div id="setupOverlay" class="setup-overlay">
        <div class="setup-inner">
            <div class="setup-title">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯ Ù„Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø©</div>
            <div class="setup-desc">Ø£Ø¯Ø®Ù„ Bin ID Ùˆ Master Key Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù€ JSONBin</div>

            <label class="setup-label">Bin ID</label>
            <input id="binIdInput" class="setup-input" placeholder="Ø§Ù„ØµÙ‚ Bin ID Ù‡Ù†Ø§" />

            <label class="setup-label">API Key (Master Key)</label>
            <input id="apiKeyInput" class="setup-input" placeholder="Ø§Ù„ØµÙ‚ Master Key Ù‡Ù†Ø§" />

            <div class="setup-actions">
                <button id="saveSetupBtn" class="setup-button-save">âœ… Ø­ÙØ¸ ÙˆØ§Ù„Ø¨Ø¯Ø¡</button>
                <button id="resetSetupBtn" class="setup-button-reset">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
            </div>
        </div>
    </div>

    <!-- ---------- Game Card ---------- -->
    <div class="game-wrap">
        <div class="card">
            <div class="title" id="title">Ø£ÙÙŠÙ†ÙˆØ² ÙˆØ§Ù„ØªÙ†Ø§Ù†ÙŠÙ†</div>
            <div id="question" class="question">Ø§Ù†ØªØ¸Ø± Ø§Ù„Ø³Ø¤Ø§Ù„ Ù…Ù† Ø§Ù„Ù…Ù‚Ø¯Ù…...</div>

            <div class="choices">
                <div class="choice" data-sticker="Ø§ÙƒØªØ¨ÙˆØ§ Ù¡" id="choiceWrapper1">
                    <div id="choice1" class="btn">Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø£ÙˆÙ„</div>
                </div>
                <div class="choice" data-sticker="Ø§ÙƒØªØ¨ÙˆØ§ Ù¢" id="choiceWrapper2">
                    <div id="choice2" class="btn">Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ</div>
                </div>
                <div class="choice" data-sticker="Ø§ÙƒØªØ¨ÙˆØ§ Ù£" id="choiceWrapper3">
                    <div id="choice3" class="btn">Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø«Ø§Ù„Ø«</div>
                </div>
                <div class="choice" data-sticker="Ø§ÙƒØªØ¨ÙˆØ§ Ù¤" id="choiceWrapper4">
                    <div id="choice4" class="btn">Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø±Ø§Ø¨Ø¹</div>
                </div>
            </div>

            <div id="status" class="status connected">ğŸŸ¢ Ø¬Ø§Ù‡Ø² - ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª</div>
        </div>
    </div>

<script>
let lastTimestamp = 0;
let checkInterval;
let BIN_ID = localStorage.getItem('q8_bin_id');
let API_KEY = localStorage.getItem('q8_api_key');

function showSetup() { document.getElementById('setupOverlay').classList.remove('hidden'); }
function hideSetup() { document.getElementById('setupOverlay').classList.add('hidden'); }

if (!BIN_ID || !API_KEY) showSetup(); else { hideSetup(); startChecking(); loadInitialData(); }

document.getElementById('saveSetupBtn').onclick = () => {
    const binId = document.getElementById('binIdInput').value.trim();
    const apiKey = document.getElementById('apiKeyInput').value.trim();
    if (!binId || !apiKey) return alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Bin ID Ùˆ API Key');
    localStorage.setItem('q8_bin_id', binId);
    localStorage.setItem('q8_api_key', apiKey);
    BIN_ID = binId; API_KEY = apiKey;
    hideSetup(); startChecking(); loadInitialData();
};

document.getElementById('resetSetupBtn').onclick = () => {
    if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªØŸ')) {
        localStorage.removeItem('q8_bin_id');
        localStorage.removeItem('q8_api_key');
        BIN_ID = null; API_KEY = null;
        showSetup();
    }
};

function showUpdateAnimation() {
    const s = document.getElementById('status');
    const q = document.getElementById('question');
    s.textContent = 'âš¡ ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ù„Ù„ØªÙˆ!'; s.className = 'status updating';
    q.classList.add('updating');
    document.querySelectorAll('.btn').forEach(b => b.classList.add('updating'));
    setTimeout(() => {
        q.classList.remove('updating');
        document.querySelectorAll('.btn').forEach(b => b.classList.remove('updating'));
        s.textContent = 'ğŸŸ¢ Ù…ØªØµÙ„ ÙˆÙ…Ø­Ø¯Ø«'; s.className = 'status connected';
    }, 2000);
}

function updateGameDisplay(data) {
    if (data.title) document.getElementById('title').textContent = data.title;
    if (data.question) document.getElementById('question').textContent = data.question;
    if (data.choices) {
        for (let i = 0; i < 4; i++) {
            const t = (data.choices[i] || '').trim();
            const el = document.getElementById('choice' + (i + 1));
            const wrap = document.getElementById('choiceWrapper' + (i + 1));
            if (t) { el.textContent = t; wrap.classList.remove('hidden'); }
            else wrap.classList.add('hidden');
        }
    }
}

async function checkForUpdates() {
    if (!BIN_ID || !API_KEY) return;
    try {
        const r = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
            headers: { 'X-Master-Key': API_KEY }
        });
        if (r.ok) {
            const res = await r.json(), data = res.record;
            if (data.timestamp && data.timestamp > lastTimestamp) {
                lastTimestamp = data.timestamp;
                showUpdateAnimation();
                updateGameDisplay(data);
            }
        }
    } catch (err) {}
}

async function loadInitialData() {
    const s = document.getElementById('status');
    s.textContent = 'ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...'; s.className = 'status';
    try {
        const r = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
            headers: { 'X-Master-Key': API_KEY }
        });
        if (r.ok) {
            const res = await r.json(), data = res.record;
            if (data.timestamp) {
                lastTimestamp = data.timestamp;
                updateGameDisplay(data);
                s.textContent = 'ğŸŸ¢ Ù…ØªØµÙ„ ÙˆÙ…Ø­Ø¯Ø«'; s.className = 'status connected';
            }
        } else {
            s.textContent = 'âš ï¸ ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Bin ID Ùˆ API Key'; s.className = 'status error';
        }
    } catch { s.textContent = 'âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„'; s.className = 'status error'; }
}

function startChecking() {
    if (checkInterval) clearInterval(checkInterval);
    checkInterval = setInterval(checkForUpdates, 1000);
}

if (BIN_ID && API_KEY) { loadInitialData(); startChecking(); }

window.addEventListener('beforeunload', () => clearInterval(checkInterval));
</script>
</body>
</html>
