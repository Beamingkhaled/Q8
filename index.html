<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Avenues & Dragons â€” Neon + Tap Challenge</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;800&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    html, body { height: 100%; }
    body {
      font-family: 'Tajawal', sans-serif;
      background: #000;
      color: #fff;
      overflow: hidden;
      user-select: none;
    }

    /* Background */
    .bg {
      position: fixed; inset: 0;
      background-size: cover; background-position: center; background-repeat: no-repeat;
      filter: blur(6px); transform: scale(1.1);
      z-index: 1;
    }

    /* Light overlay (0.15) */
    .overlay {
      position: fixed; inset: 0; z-index: 2;
      background: rgba(0,0,0,0.15);
    }

    /* Main card */
    .game-container {
      position: relative; z-index: 3;
      width: 92%; max-width: 560px; margin: 12vh auto 0; padding: 20px;
      text-align: center;
      backdrop-filter: blur(6px);
      background: rgba(10,10,30,0.25);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 18px;
      box-shadow: 0 0 28px rgba(0,0,0,0.25);
    }

    h1 {
      font-size: 34px; font-weight: 800; margin-bottom: 10px;
      text-shadow: 0 0 8px rgba(255,255,255,0.4);
    }

    #question {
      font-size: 22px; margin-bottom: 18px; color: #eee;
      text-shadow: 0 0 6px rgba(0,0,0,0.4);
      line-height: 1.5;
    }

    /* Neon boxes */
    .choice {
      position: relative;
      background: rgba(20,20,35,0.75);
      border: 2px solid #7a5cff;
      padding: 18px;
      font-size: 22px;
      color: #fff;
      border-radius: 16px;
      box-shadow: 0 0 18px #7a5cff66, inset 0 0 12px #7a5cff22;
      margin-bottom: 18px;
      transition: 0.15s ease;
    }
    .choice:active {
      transform: scale(0.97);
      box-shadow: 0 0 26px #a889ffcc, inset 0 0 18px #7a5cff55;
    }

    /* Stickers */
    .sticker {
      position: absolute;
      top: -12px;
      left: -12px;
      background: rgba(255,255,255,0.25);
      backdrop-filter: blur(6px);
      padding: 6px 12px;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 700;
      color: #fff;
      border: 1px solid rgba(255,255,255,0.45);
      box-shadow: 0 0 12px rgba(255,255,255,0.2);
      pointer-events: none;
    }

    #status { margin-top: 10px; font-size: 14px; color: #ddd; opacity: 0.85; }

    /* TAP CHALLENGE */
    #tapChallenge { display: none; }
    .tap-wrap {
      display: flex; flex-direction: column; gap: 14px; align-items: center;
    }
    .tap-title { font-size: 24px; font-weight: 800; }
    .tap-sub { font-size: 16px; opacity: 0.9; }

    .tap-hud {
      display: flex; gap: 12px; align-items: center; flex-wrap: wrap; justify-content: center;
      font-size: 16px;
    }
    .hud-pill {
      background: rgba(255,255,255,0.18);
      border: 1px solid rgba(255,255,255,0.35);
      border-radius: 999px;
      padding: 6px 12px;
      backdrop-filter: blur(6px);
    }

    .tap-progress {
      width: 100%; height: 16px;
      background: rgba(255,255,255,0.12);
      border: 1px solid rgba(255,255,255,0.25);
      border-radius: 999px;
      overflow: hidden;
    }
    .tap-bar {
      height: 100%; width: 0%;
      background: radial-gradient(120% 120% at 0% 50%, #7a5cff, #a46bff);
      transition: width 0.08s linear;
    }

    .tap-button {
      font-size: 26px; font-weight: 800;
      padding: 14px 28px;
      border: 2px solid #7a5cff;
      border-radius: 16px;
      color: #fff;
      background: rgba(20,20,35,0.9);
      box-shadow: 0 0 18px #7a5cff66;
    }
    .tap-button:active { transform: scale(0.98); }

    .tap-result { font-size: 20px; font-weight: 800; margin-top: 6px; }
    .win { color: #7dffae; }
    .lose { color: #ff7d7d; }
  </style>
</head>
<body>

  <div class="bg" id="bg" style="background-image: url('bg.jpg');"></div>
  <div class="overlay"></div>

  <div class="game-container" id="card">

    <!-- VOTE MODE -->
    <div id="voteMode">
      <h1>Avenues & Dragons</h1>
      <div id="question">...</div>

      <div id="choice1" class="choice">
        <div class="sticker">Ø§ÙƒØªØ¨ÙˆØ§ Ù¡</div>
        <span id="choice1Text">...</span>
      </div>

      <div id="choice2" class="choice">
        <div class="sticker">Ø§ÙƒØªØ¨ÙˆØ§ Ù¢</div>
        <span id="choice2Text">...</span>
      </div>

      <div id="status">Ù…ØªØµÙ„ Â· ÙŠØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§</div>
    </div>

    <!-- TAP MODE -->
    <div id="tapChallenge">
      <div class="tap-wrap">
        <div class="tap-title" id="tapTitle">ØªØ­Ø¯Ù‘ÙŠ Ø§Ù„Ø·Ù‚ ğŸ”¥</div>
        <div class="tap-sub" id="tapDesc">Ø§Ø¶ØºØ·ÙˆØ§ Ø¨Ø£Ø³Ø±Ø¹ Ù…Ø§ ÙŠÙ…ÙƒÙ†!</div>

        <div class="tap-hud">
          <div class="hud-pill">Ø§Ù„Ù‡Ø¯Ù: <span id="tapGoal">1000</span></div>
          <div class="hud-pill">Ø§Ù„ÙˆÙ‚Øª: <span id="tapTimer">60</span></div>
          <div class="hud-pill">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: <span id="tapCount">0</span></div>
        </div>

        <div class="tap-progress"><div class="tap-bar" id="tapBar"></div></div>

        <button class="tap-button" id="tapButton">Ø·ÙÙ‚!</button>
        <div class="tap-result" id="tapResult"></div>
      </div>

      <div id="statusTap" style="margin-top:10px; font-size:14px;">Ù…ØªØµÙ„ Â· ÙŠØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§</div>
    </div>

  </div>

  <script>
    const BACKEND_URL = "https://beamingkhaled.github.io/backend.json";
    const POLL = 1000;

    let mode = null;
    let tapTimer = null;
    let tapGoal = 0, tapCount = 0, tapEnd = 0;

    const el = {
      bg: document.getElementById("bg"),
      vote: document.getElementById("voteMode"),
      tap: document.getElementById("tapChallenge"),
      q: document.getElementById("question"),
      c1: document.getElementById("choice1Text"),
      c2: document.getElementById("choice2Text"),
      st: document.getElementById("status"),
      stt: document.getElementById("statusTap"),
      tapTitle: document.getElementById("tapTitle"),
      tapDesc: document.getElementById("tapDesc"),
      tapGoal: document.getElementById("tapGoal"),
      tapTimer: document.getElementById("tapTimer"),
      tapCount: document.getElementById("tapCount"),
      tapBar: document.getElementById("tapBar"),
      tapBtn: document.getElementById("tapButton"),
      tapResult: document.getElementById("tapResult")
    };

    function showVote() {
      el.tap.style.display = "none";
      el.vote.style.display = "block";
      mode = "vote";
    }

    function showTap() {
      el.vote.style.display = "none";
      el.tap.style.display = "block";
      mode = "tap";
    }

    function stopTap() {
      clearInterval(tapTimer);
      tapTimer = null;
    }

    function startTap(cfg) {
      stopTap();
      tapGoal = Number(cfg.goal || 1000);
      tapCount = 0;
      let duration = Number(cfg.duration || 60);
      tapEnd = Date.now() + duration * 1000;

      el.tapTitle.textContent = cfg.title || "ØªØ­Ø¯Ù‘ÙŠ Ø§Ù„Ø·Ù‚ ğŸ”¥";
      el.tapDesc.textContent = cfg.description || "Ø§Ø¶ØºØ·ÙˆØ§ Ø¨Ø£Ø³Ø±Ø¹ Ù…Ø§ ÙŠÙ…ÙƒÙ†!";
      el.tapGoal.textContent = tapGoal;
      el.tapCount.textContent = tapCount;
      el.tapTimer.textContent = duration;
      el.tapBar.style.width = "0%";
      el.tapResult.textContent = "";

      el.tapBtn.onclick = () => {
        if (Date.now() < tapEnd) {
          tapCount++;
          el.tapCount.textContent = tapCount;
          el.tapBar.style.width = Math.min(100, tapCount / tapGoal * 100) + "%";
        }
      };

      document.getElementById("card").onclick = e => {
        if (e.target === el.tapBtn) return;
        if (Date.now() < tapEnd) {
          tapCount++;
          el.tapCount.textContent = tapCount;
          el.tapBar.style.width = Math.min(100, tapCount / tapGoal * 100) + "%";
        }
      };

      tapTimer = setInterval(() => {
        let left = Math.ceil((tapEnd - Date.now()) / 1000);
        if (left < 0) left = 0;
        el.tapTimer.textContent = left;
        if (left === 0) {
          stopTap();
          if (tapCount >= tapGoal) {
            el.tapResult.textContent = "ğŸ”¥ Ù…Ø¨Ø±ÙˆÙƒ! Ù†Ø¬Ø­ØªÙˆØ§!";
            el.tapResult.className = "tap-result win";
          } else {
            el.tapResult.textContent = "ğŸ˜®â€ğŸ’¨ Ù…Ø§ Ù„Ø­Ù‘Ù‚Ù†Ø§!";
            el.tapResult.className = "tap-result lose";
          }
        }
      }, 200);
    }

    async function loop() {
      try {
        const res = await fetch(BACKEND_URL + "?nocache=" + Date.now());
        const data = await res.json();

        if (data.bg) el.bg.style.backgroundImage = `url('${data.bg}')`;

        if (data.mode === "tap") {
          if (mode !== "tap") {
            showTap();
            startTap(data.tap || {});
          }
          el.stt.textContent = "Ù…ØªØµÙ„ Â· ÙŠØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§";
        } else {
          if (mode !== "vote") {
            showVote();
            stopTap();
          }
          el.q.textContent = data.question || "...";
          el.c1.textContent = data.choice1 || "...";
          el.c2.textContent = data.choice2 || "...";
          el.st.textContent = "Ù…ØªØµÙ„ Â· ÙŠØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§";
        }

      } catch {
        if (mode === "tap") el.stt.textContent = "ØºÙŠØ± Ù…ØªØµÙ„";
        else el.st.textContent = "ØºÙŠØ± Ù…ØªØµÙ„";
      }
    }

    setInterval(loop, POLL);
    loop();
  </script>
</body>
</html>
