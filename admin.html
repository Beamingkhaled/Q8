<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… â€” Avenues & Dragons</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;800&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#0b0b12;--card:#121228;--ink:#fff;--muted:#c8c8e0;--accent:#7a5cff;--ok:#47d18c;--bad:#ff6b6b}
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:"Tajawal",sans-serif;background:radial-gradient(1200px 600px at 50% -10%,#1a1935 0%,#0b0b12 55%);color:var(--ink)}
    .wrap{max-width:720px;margin:24px auto;padding:16px}
    h1{font-weight:800;margin:0 0 14px;font-size:28px}
    p.hint{color:var(--muted);margin:0 0 18px;font-size:14px}
    .card{background:rgba(18,18,40,.9);border:1px solid rgba(255,255,255,.08);border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.35);padding:16px;margin-bottom:16px}
    .row{display:grid;grid-template-columns:130px 1fr;gap:10px;align-items:center;margin:10px 0}
    label{font-weight:700}
    input[type="text"],input[type="url"],input[type="number"],select,textarea{
      width:100%;padding:12px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.05);color:var(--ink);font-size:16px;outline:none
    }
    textarea{min-height:72px;resize:vertical}
    .muted{color:var(--muted);font-size:12px}
    .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
    button{
      appearance:none;border:none;border-radius:12px;padding:12px 16px;font-weight:800;font-size:16px;
      background:var(--accent);color:#fff;cursor:pointer;box-shadow:0 0 18px #7a5cff66
    }
    button.secondary{background:rgba(255,255,255,.08)}
    button.good{background:var(--ok)}
    button.bad{background:var(--bad)}
    .status{margin-top:10px;font-size:14px}
    .ok{color:var(--ok)} .err{color:var(--bad)}
    .footer{margin-top:12px;color:var(--muted);font-size:13px}
    .inline{display:inline-block;margin-inline-start:6px}
    .pill{display:inline-block;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.15);font-size:12px}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media (max-width:640px){.row{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… â€” Avenues & Dragons</h1>
    <p class="hint">Ø¹Ø¯Ù‘Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ø³Ø¤Ø§Ù„ ÙˆØ§Ù„Ø§Ø®ØªÙŠØ§Ø±Ø§Øª ÙˆØ§Ù„Ø®Ù„ÙÙŠØ© Ù…Ø¹ Ø­ÙØ¸ ÙÙˆØ±ÙŠ Ø¥Ù„Ù‰ <span class="pill">MyJSON</span> â€” Ù„Ø§ Ø­Ø§Ø¬Ø© Ù„Ø£ÙŠ JSON Ø£Ùˆ ÙƒÙˆØ¯.</p>

    <!-- Connection -->
    <div class="card">
      <div class="row">
        <label>Ø±Ø§Ø¨Ø· MyJSON</label>
        <input id="recordUrl" type="url" placeholder="https://api.myjson.online/v1/records/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx">
      </div>
      <div class="row">
        <label>API Key</label>
        <input id="apiKey" type="text" placeholder="Ø£Ù„ØµÙ‚ Ù…ÙØªØ§Ø­ MyJSON (Ø³ÙŠÙØ­ÙØ¸ Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙÙŠ Ø¬Ù‡Ø§Ø²Ùƒ)">
      </div>
      <div class="actions">
        <button id="loadBtn" class="secondary">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø­Ø§Ù„ÙŠ</button>
        <button id="saveBtn" class="good">Ø­ÙØ¸ Ø§Ù„Ø¢Ù† (ÙÙˆØ±ÙŠ)</button>
        <button id="clearBtn" class="bad">Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„</button>
      </div>
      <div id="connStatus" class="status"></div>
    </div>

    <!-- Content form -->
    <div class="card">
      <div class="row">
        <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù„Ø¹Ø¨Ø©</label>
        <input id="title" type="text" placeholder="Avenues & Dragons">
      </div>
      <div class="row">
        <label>Ø§Ù„Ø³Ø¤Ø§Ù„</label>
        <textarea id="question" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø³Ø¤Ø§Ù„ Ù‡Ù†Ø§"></textarea>
      </div>
      <div class="grid2">
        <div class="row">
          <label>Ø§Ù„Ø®ÙŠØ§Ø± Ù¡</label>
          <input id="choice1" type="text" placeholder="Ù†Ø±ÙˆØ­ Ù†Ø´ØªØ±ÙŠ Ù‚Ù‡ÙˆØ©">
        </div>
        <div class="row">
          <label>Ø§Ù„Ø®ÙŠØ§Ø± Ù¢</label>
          <input id="choice2" type="text" placeholder="Ù†ØªÙ…Ø´Ù‰ Ø´ÙˆÙŠ">
        </div>
      </div>
      <div class="row">
        <label>Ø§Ù„Ø®Ù„ÙÙŠØ©</label>
        <input id="bg" type="text" placeholder="bg.jpg Ø£Ùˆ Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© ÙƒØ§Ù…Ù„">
      </div>
      <div class="row">
        <label>Ø§Ù„Ù†Ù…Ø·</label>
        <select id="mode">
          <option value="vote">ØªØµÙˆÙŠØª (Ø®ÙŠØ§Ø±ÙŠÙ†)</option>
          <option value="tap">ØªØ­Ø¯Ù‘ÙŠ Ø§Ù„Ø·Ù‚</option>
        </select>
      </div>
      <div id="tapWrap">
        <div class="grid2">
          <div class="row">
            <label>Ù‡Ø¯Ù Ø§Ù„Ø·Ù‚</label>
            <input id="tapGoal" type="number" min="1" value="1000">
          </div>
          <div class="row">
            <label>Ø§Ù„Ù…Ø¯Ø© (Ø«)</label>
            <input id="tapDuration" type="number" min="5" value="60">
          </div>
        </div>
        <div class="row">
          <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªØ­Ø¯Ù‘ÙŠ</label>
          <input id="tapTitle" type="text" value="ØªØ­Ø¯Ù‘ÙŠ Ø§Ù„Ø·Ù‚ ğŸ”¥">
        </div>
        <div class="row">
          <label>ÙˆØµÙ Ø§Ù„ØªØ­Ø¯Ù‘ÙŠ</label>
          <input id="tapDesc" type="text" value="Ù†ÙˆØµÙ„ Ù¡Ù Ù Ù  Ø·Ù‚Ø© Ø®Ù„Ø§Ù„ Ø¯Ù‚ÙŠÙ‚Ø©ØŸ">
        </div>
      </div>
      <div id="saveStatus" class="status"></div>
    </div>

    <!-- Viewer link -->
    <div class="card">
      <div class="row">
        <label>Ø±Ø§Ø¨Ø· Ø§Ù„Ø¹Ø±Ø¶</label>
        <input id="viewerLink" type="text" readonly>
      </div>
      <div class="actions">
        <a id="openViewer" class="inline" href="#" target="_blank"><button>ÙØªØ­ Ø§Ù„ØµÙØ­Ø© Ù…Ø¨Ø§Ø´Ø±Ø©</button></a>
      </div>
      <div class="footer">Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© ØªØ­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙÙŠ Ù…ØªØµÙØ­Ùƒ (localStorage) Ø­ØªÙ‰ Ù„Ø§ ØªÙØ¹ÙŠØ¯ Ù„ØµÙ‚ Ø§Ù„Ù…ÙØ§ØªÙŠØ­ ÙƒÙ„ Ù…Ø±Ø©.</div>
    </div>
  </div>

  <script>
    // ---- helpers ----
    const $ = (id)=>document.getElementById(id);
    const fields = ["title","question","choice1","choice2","bg","mode","tapGoal","tapDuration","tapTitle","tapDesc"];
    const ls = {
      get:k=>localStorage.getItem(k)||"",
      set:(k,v)=>localStorage.setItem(k,v||""),
    };

    // Prefill secrets from localStorage
    $("recordUrl").value = ls.get("myjson_record_url") || "https://api.myjson.online/v1/records/f3c971a4-3c36-408b-a054-8720c4316121";
    $("apiKey").value    = ls.get("myjson_api_key");

    // Update viewer link
    function refreshViewerLink(){
      const u = $("recordUrl").value.trim();
      const enc = encodeURIComponent(u);
      const link = location.origin + location.pathname.replace(/admin\.html$/,"") + "?data_url=" + enc;
      $("viewerLink").value = link;
      $("openViewer").href = link;
    }
    refreshViewerLink();

    // Show/hide tap fields
    function toggleTap(){
      $("tapWrap").style.display = $("mode").value === "tap" ? "block" : "none";
    }
    $("mode").addEventListener("change", toggleTap); toggleTap();

    // Compose payload
    function gather(){
      const data = {
        title: $("title").value.trim(),
        mode: $("mode").value,
        question: $("question").value.trim(),
        choice1: $("choice1").value.trim(),
        choice2: $("choice2").value.trim(),
        bg: $("bg").value.trim()
      };
      if (data.mode === "tap") {
        data.tap = {
          goal: Number($("tapGoal").value||1000),
          duration: Number($("tapDuration").value||60),
          title: $("tapTitle").value.trim() || "ØªØ­Ø¯Ù‘ÙŠ Ø§Ù„Ø·Ù‚ ğŸ”¥",
          description: $("tapDesc").value.trim() || "Ù†ÙˆØµÙ„ Ù¡Ù Ù Ù  Ø·Ù‚Ø© Ø®Ù„Ø§Ù„ Ø¯Ù‚ÙŠÙ‚Ø©ØŸ"
        };
      }
      return data;
    }

    // Load existing from MyJSON
    $("loadBtn").onclick = async ()=>{
      const url = $("recordUrl").value.trim();
      if(!url){ $("connStatus").innerHTML = '<span class="err">Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· MyJSON</span>'; return; }
      $("connStatus").textContent = "Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...";
      try{
        const res = await fetch(url + (url.includes("?")?"&":"?") + "nocache=" + Date.now());
        const json = await res.json();
        const data = json && json.data ? json.data : json;

        $("title").value    = data.title || "";
        $("mode").value     = (data.mode || "vote");
        $("question").value = data.question || "";
        $("choice1").value  = data.choice1 || "";
        $("choice2").value  = data.choice2 || "";
        $("bg").value       = data.bg || "";
        if(data.tap){
          $("tapGoal").value     = data.tap.goal || 1000;
          $("tapDuration").value = data.tap.duration || 60;
          $("tapTitle").value    = data.tap.title || "ØªØ­Ø¯Ù‘ÙŠ Ø§Ù„Ø·Ù‚ ğŸ”¥";
          $("tapDesc").value     = data.tap.description || "";
        }
        toggleTap();
        $("connStatus").innerHTML = '<span class="ok">ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„ âœ…</span>';
        ls.set("myjson_record_url", url);
        refreshViewerLink();
      }catch(e){
        $("connStatus").innerHTML = '<span class="err">ÙØ´Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„ âŒ</span>';
      }
    };

    // Save to MyJSON (PUT with API key)
    $("saveBtn").onclick = async ()=>{
      const url = $("recordUrl").value.trim();
      const key = $("apiKey").value.trim();
      if(!url || !key){
        $("saveStatus").innerHTML = '<span class="err">Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· MyJSON Ùˆ Ø§Ù„Ù€ API Key</span>';
        return;
      }
      const payload = { data: gather() };
      $("saveStatus").textContent = "Ø¬Ø§Ø±Ù Ø§Ù„Ø­ÙØ¸...";
      try{
        const res = await fetch(url, {
          method: "PUT",
          headers: { "Content-Type": "application/json", "X-API-KEY": key },
          body: JSON.stringify(payload)
        });
        if(!res.ok) throw new Error(await res.text());
        $("saveStatus").innerHTML = '<span class="ok">ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ… â€” ÙŠØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« ÙÙˆØ±Ù‹Ø§ Ø¹Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„Ø¹Ø±Ø¶</span>';
        ls.set("myjson_api_key", key);
        ls.set("myjson_record_url", url);
        refreshViewerLink();
      }catch(e){
        $("saveStatus").innerHTML = '<span class="err">ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸ âŒ â€” ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ø§Ù„Ù€ API Key ÙˆØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„ÙƒØªØ§Ø¨Ø©</span>';
      }
    };

    $("clearBtn").onclick = ()=>{
      fields.forEach(id=>$(id).value="");
      $("mode").value="vote"; toggleTap();
      $("saveStatus").textContent=""; $("connStatus").textContent="";
    };
  </script>
</body>
</html>
